{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/hp/Downloads/anonymous-social-platform/components/theme-toggle.tsx"],"sourcesContent":["'use client'\n\nimport { useEffect, useState } from 'react'\n\nexport function ThemeToggle() {\n  const [mounted, setMounted] = useState(false)\n  const [isDark, setIsDark] = useState(true)\n\n  useEffect(() => {\n    setMounted(true)\n    const savedTheme = localStorage.getItem('theme') || 'dark'\n    const isDarkMode = savedTheme === 'dark'\n    setIsDark(isDarkMode)\n    document.documentElement.classList.toggle('dark', isDarkMode)\n  }, [])\n\n  const toggleTheme = () => {\n    const newTheme = isDark ? 'light' : 'dark'\n    setIsDark(!isDark)\n    localStorage.setItem('theme', newTheme)\n    document.documentElement.classList.toggle('dark', newTheme === 'dark')\n    document.body.classList.toggle('light', newTheme === 'light')\n  }\n\n  if (!mounted) return null\n\n  return (\n    <button\n      onClick={toggleTheme}\n      className=\"p-2 rounded-full hover:bg-dark-secondary transition-colors\"\n      aria-label=\"Toggle theme\"\n    >\n      {isDark ? '‚òÄÔ∏è' : 'üåô'}\n    </button>\n  )\n}\n"],"names":[],"mappings":";;;;;AAEA;AAFA;;;AAIO,SAAS;IACd,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,0WAAQ,EAAC;IACvC,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,0WAAQ,EAAC;IAErC,IAAA,2WAAS,EAAC;QACR,WAAW;QACX,MAAM,aAAa,aAAa,OAAO,CAAC,YAAY;QACpD,MAAM,aAAa,eAAe;QAClC,UAAU;QACV,SAAS,eAAe,CAAC,SAAS,CAAC,MAAM,CAAC,QAAQ;IACpD,GAAG,EAAE;IAEL,MAAM,cAAc;QAClB,MAAM,WAAW,SAAS,UAAU;QACpC,UAAU,CAAC;QACX,aAAa,OAAO,CAAC,SAAS;QAC9B,SAAS,eAAe,CAAC,SAAS,CAAC,MAAM,CAAC,QAAQ,aAAa;QAC/D,SAAS,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,SAAS,aAAa;IACvD;IAEA,IAAI,CAAC,SAAS,OAAO;IAErB,qBACE,uYAAC;QACC,SAAS;QACT,WAAU;QACV,cAAW;kBAEV,SAAS,OAAO;;;;;;AAGvB"}},
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/hp/Downloads/anonymous-social-platform/lib/firestore-utils.ts"],"sourcesContent":["import {\n  collection,\n  doc,\n  setDoc,\n  getDoc,\n  addDoc,\n  query,\n  orderBy,\n  limit,\n  getDocs,\n  updateDoc,\n  increment,\n  writeBatch,\n} from 'firebase/firestore'\nimport { getDbInstance, isFirebaseReady } from './firebase'\n\nconst checkFirebase = (operation: string = 'operation') => {\n  if (!isFirebaseReady()) {\n    console.warn(`[v0] Firebase not ready for ${operation}`)\n    return false\n  }\n  const db = getDbInstance()\n  if (!db) {\n    console.warn(`[v0] Firestore database not initialized for ${operation}`)\n    return false\n  }\n  return true\n}\n\nconst getDb = () => {\n  const db = getDbInstance()\n  if (!db) {\n    throw new Error('Firestore not initialized')\n  }\n  return db\n}\n\n// Create or update user\nexport async function createUser(uid: string, userData: any) {\n  if (!checkFirebase('createUser')) return\n\n  try {\n    const db = getDb()\n    const userRef = doc(db, 'users', uid)\n    const userSnap = await getDoc(userRef)\n\n    if (!userSnap.exists()) {\n      await setDoc(userRef, {\n        uid,\n        username: userData.username || '',\n        bio: userData.bio || '',\n        avatar: userData.avatar || 'üëª',\n        coverGradient: userData.coverGradient || 'from-primary to-accent',\n        createdAt: new Date(),\n      })\n      console.log('[v0] User created:', uid)\n    }\n  } catch (error) {\n    console.error('[v0] Error creating user:', error)\n  }\n}\n\n// Get user data\nexport async function getUser(uid: string) {\n  if (!checkFirebase('getUser') || !uid) {\n    console.error('[v0] Invalid user ID or Firebase not ready')\n    return null\n  }\n\n  try {\n    const db = getDb()\n    const userRef = doc(db, 'users', uid)\n    const userSnap = await getDoc(userRef)\n    \n    if (!userSnap.exists()) {\n      console.log(`[v0] User not found: ${uid}`)\n      return null\n    }\n    \n    return userSnap.data()\n  } catch (error) {\n    console.error('[v0] Error getting user:', error)\n    return null\n  }\n}\n\n// Create post\nexport async function createPost(postData: any) {\n  if (!checkFirebase('createPost')) throw new Error('Firebase not initialized')\n\n  try {\n    const db = getDb()\n    const postsRef = collection(db, 'posts')\n    const docRef = await addDoc(postsRef, {\n      ...postData,\n      likeCount: 0,\n      commentCount: 0,\n      reportCount: 0,\n      createdAt: new Date(),\n    })\n\n    // Update user's post count\n    if (postData.authorUid) {\n      const userRef = doc(db, 'users', postData.authorUid)\n      await updateDoc(userRef, {\n        postCount: increment(1),\n      })\n    }\n\n    console.log('[v0] Post created:', docRef.id)\n    return docRef.id\n  } catch (error) {\n    console.error('[v0] Error creating post:', error)\n    throw error\n  }\n}\n\nexport async function updatePostAudio(postId: string, audioData: any) {\n  if (!checkFirebase('updatePostAudio')) throw new Error('Firebase not initialized')\n\n  try {\n    const db = getDb()\n    const postRef = doc(db, 'posts', postId)\n    await updateDoc(postRef, audioData)\n  } catch (error) {\n    console.error('[v0] Error updating post audio:', error)\n    throw error\n  }\n}\n\nexport async function updatePostMetadata(postId: string, metadata: any) {\n  if (!checkFirebase('updatePostMetadata')) throw new Error('Firebase not initialized')\n\n  try {\n    const db = getDb()\n    const postRef = doc(db, 'posts', postId)\n    await updateDoc(postRef, metadata)\n  } catch (error) {\n    console.error('[v0] Error updating post metadata:', error)\n    throw error\n  }\n}\n\n// Get posts (with pagination)\nexport async function getPosts(limitCount = 20) {\n  if (!checkFirebase('getPosts')) return []\n\n  try {\n    const db = getDb()\n    const postsRef = collection(db, 'posts')\n    const q = query(\n      postsRef,\n      orderBy('createdAt', 'desc'),\n      limit(limitCount)\n    )\n    const querySnapshot = await getDocs(q)\n    const posts = querySnapshot.docs.map((doc) => ({\n      id: doc.id,\n      ...doc.data(),\n    }))\n    console.log('[v0] Loaded posts:', posts.length)\n    return posts\n  } catch (error) {\n    console.error('[v0] Error getting posts:', error)\n    return []\n  }\n}\n\n// Get user posts\nexport async function getUserPosts(uid: string) {\n  if (!checkFirebase('getUserPosts')) return []\n\n  try {\n    const db = getDb()\n    const postsRef = collection(db, 'posts')\n    const q = query(\n      postsRef,\n      orderBy('createdAt', 'desc')\n    )\n    const querySnapshot = await getDocs(q)\n    return querySnapshot.docs\n      .filter((doc: any) => doc.data().authorUid === uid)\n      .map((doc) => ({\n        id: doc.id,\n        ...doc.data(),\n      }))\n  } catch (error) {\n    console.error('[v0] Error getting user posts:', error)\n    return []\n  }\n}\n\n// Like post\nexport async function likePost(postId: string, userId: string) {\n  if (!checkFirebase('likePost')) throw new Error('Firebase not initialized')\n\n  try {\n    const db = getDb()\n    const batch = writeBatch(db)\n\n    // Add to user's likes subcollection\n    const likesRef = doc(db, 'users', userId, 'likes', postId)\n    batch.set(likesRef, { createdAt: new Date() })\n\n    // Increment post likeCount\n    const postRef = doc(db, 'posts', postId)\n    batch.update(postRef, { likeCount: increment(1) })\n\n    await batch.commit()\n  } catch (error) {\n    console.error('[v0] Error liking post:', error)\n    throw error\n  }\n}\n\n// Unlike post\nexport async function unlikePost(postId: string, userId: string) {\n  if (!checkFirebase('unlikePost')) throw new Error('Firebase not initialized')\n\n  try {\n    const db = getDb()\n    const batch = writeBatch(db)\n\n    // Remove from user's likes subcollection\n    const likesRef = doc(db, 'users', userId, 'likes', postId)\n    batch.delete(likesRef)\n\n    // Decrement post likeCount\n    const postRef = doc(db, 'posts', postId)\n    batch.update(postRef, { likeCount: increment(-1) })\n\n    await batch.commit()\n  } catch (error) {\n    console.error('[v0] Error unliking post:', error)\n    throw error\n  }\n}\n\n// Get user likes\nexport async function getUserLikes(userId: string) {\n  if (!checkFirebase('getUserLikes')) return new Set()\n\n  try {\n    const db = getDb()\n    const likesRef = collection(db, 'users', userId, 'likes')\n    const querySnapshot = await getDocs(likesRef)\n    return new Set(querySnapshot.docs.map((doc) => doc.id))\n  } catch (error) {\n    console.error('[v0] Error getting user likes:', error)\n    return new Set()\n  }\n}\n\n// Add comment\nexport async function addComment(postId: string, commentData: any) {\n  if (!checkFirebase('addComment')) throw new Error('Firebase not initialized')\n\n  try {\n    const db = getDb()\n    const batch = writeBatch(db)\n\n    // Add comment to comments collection\n    const commentsRef = collection(db, 'comments')\n    const commentDocRef = await addDoc(commentsRef, {\n      postId,\n      ...commentData,\n      createdAt: new Date(),\n    })\n\n    // Increment post commentCount\n    const postRef = doc(db, 'posts', postId)\n    batch.update(postRef, { commentCount: increment(1) })\n\n    await batch.commit()\n    return commentDocRef.id\n  } catch (error) {\n    console.error('[v0] Error adding comment:', error)\n    throw error\n  }\n}\n\n// Get comments for post\nexport async function getPostComments(postId: string) {\n  if (!checkFirebase('getPostComments')) return []\n\n  try {\n    const db = getDb()\n    const commentsRef = collection(db, 'comments')\n    const q = query(\n      commentsRef,\n      orderBy('createdAt', 'desc')\n    )\n    const querySnapshot = await getDocs(q)\n    return querySnapshot.docs\n      .filter((doc: any) => doc.data().postId === postId)\n      .map((doc) => ({\n        id: doc.id,\n        ...doc.data(),\n      }))\n  } catch (error) {\n    console.error('[v0] Error getting comments:', error)\n    return []\n  }\n}\n\n// Report post\nexport async function reportPost(postId: string, userId: string, reason: string) {\n  if (!checkFirebase('reportPost')) throw new Error('Firebase not initialized')\n\n  try {\n    const db = getDb()\n    const batch = writeBatch(db)\n\n    // Add report\n    const reportsRef = collection(db, 'comments')\n    await addDoc(reportsRef, {\n      postId,\n      reportingUid: userId,\n      reason,\n      createdAt: new Date(),\n    })\n\n    // Increment post reportCount\n    const postRef = doc(db, 'posts', postId)\n    batch.update(postRef, { reportCount: increment(1) })\n\n    await batch.commit()\n  } catch (error) {\n    console.error('[v0] Error reporting post:', error)\n    throw error\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 358, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/hp/Downloads/anonymous-social-platform/lib/auth-service.ts"],"sourcesContent":["import {\n  signInAnonymously as firebaseSignInAnonymously,\n  signOut,\n  onAuthStateChanged,\n  User,\n} from 'firebase/auth'\nimport { getAuthInstance, isFirebaseReady } from './firebase'\nimport { createUser } from './firestore-utils'\n\n/**\n * Sign in anonymously (no email/password required)\n */\nexport async function signInAnonymously() {\n  try {\n    console.log('[Auth] Starting Anonymous Sign In...')\n    \n    // Ensure Firebase is initialized\n    if (!isFirebaseReady()) {\n      throw new Error('Failed to initialize Firebase. Please check your configuration.')\n    }\n\n    const auth = getAuthInstance()\n    if (!auth) {\n      throw new Error('Authentication service is not available. Please try again later.')\n    }\n\n    console.log('[Auth] Starting anonymous sign in...')\n    const result = await firebaseSignInAnonymously(auth)\n      .catch((error: any) => {\n        console.error('[Auth] Anonymous sign in error:', {\n          code: error.code,\n          message: error.message,\n          name: error.name,\n        })\n        throw error\n      })\n      \n    const user = result.user\n\n    if (!user) {\n      throw new Error('Failed to authenticate anonymously. No user returned.')\n    }\n\n    console.log('[Auth] User authenticated anonymously:', { uid: user.uid })\n    \n    // Create user document if it doesn't exist\n    try {\n      await createUser(user.uid, {\n        username: '', // Will be set via username setup\n        bio: '',\n        avatar: 'üëª', // Default anonymous avatar\n        coverGradient: 'from-primary to-accent',\n      })\n    } catch (userError) {\n      // User might already exist, that's okay\n      console.log('[Auth] User document creation skipped (may already exist)')\n    }\n    \n    return user\n  } catch (error: any) {\n    console.error('[Auth] Error in signInAnonymously:', {\n      name: error.name,\n      code: error.code,\n      message: error.message,\n    })\n    \n    let errorMessage = 'Failed to sign in anonymously'\n    \n    if (error.code === 'auth/operation-not-allowed' || error.code === 'auth/admin-restricted-operation') {\n      errorMessage = 'Anonymous authentication is not enabled in Firebase. Please enable it in Firebase Console: Authentication > Sign-in method > Anonymous > Enable'\n    } else if (error.code === 'auth/network-request-failed') {\n      errorMessage = 'Network error. Please check your connection and try again.'\n    } else if (error.message) {\n      errorMessage = error.message\n    }\n    \n    throw new Error(errorMessage)\n  }\n}\n\nexport async function signOutUser() {\n  if (!isFirebaseReady()) {\n    throw new Error('Firebase is not properly configured')\n  }\n\n  try {\n    const auth = getAuthInstance()\n    if (!auth) {\n      throw new Error('Authentication service not available')\n    }\n    await signOut(auth)\n  } catch (error) {\n    console.error('[v0] Error signing out:', error)\n    throw error\n  }\n}\n\nexport function onAuthChange(callback: (user: User | null) => void) {\n  if (!isFirebaseReady()) {\n    console.warn('[v0] Firebase not ready for auth changes')\n    callback(null)\n    return () => {}\n  }\n\n  try {\n    const auth = getAuthInstance()\n    if (!auth) {\n      callback(null)\n      return () => {}\n    }\n    return onAuthStateChanged(auth, callback)\n  } catch (error) {\n    console.error('[v0] Error setting up auth listener:', error)\n    callback(null)\n    return () => {}\n  }\n}\n "],"names":[],"mappings":";;;;;;;;AAAA;AAAA;AAMA;AACA;;;;AAKO,eAAe;IACpB,IAAI;QACF,QAAQ,GAAG,CAAC;QAEZ,iCAAiC;QACjC,IAAI,CAAC,IAAA,kLAAe,KAAI;YACtB,MAAM,IAAI,MAAM;QAClB;QAEA,MAAM,OAAO,IAAA,kLAAe;QAC5B,IAAI,CAAC,MAAM;YACT,MAAM,IAAI,MAAM;QAClB;QAEA,QAAQ,GAAG,CAAC;QACZ,MAAM,SAAS,MAAM,IAAA,2UAAyB,EAAC,MAC5C,KAAK,CAAC,CAAC;YACN,QAAQ,KAAK,CAAC,mCAAmC;gBAC/C,MAAM,MAAM,IAAI;gBAChB,SAAS,MAAM,OAAO;gBACtB,MAAM,MAAM,IAAI;YAClB;YACA,MAAM;QACR;QAEF,MAAM,OAAO,OAAO,IAAI;QAExB,IAAI,CAAC,MAAM;YACT,MAAM,IAAI,MAAM;QAClB;QAEA,QAAQ,GAAG,CAAC,0CAA0C;YAAE,KAAK,KAAK,GAAG;QAAC;QAEtE,2CAA2C;QAC3C,IAAI;YACF,MAAM,IAAA,uLAAU,EAAC,KAAK,GAAG,EAAE;gBACzB,UAAU;gBACV,KAAK;gBACL,QAAQ;gBACR,eAAe;YACjB;QACF,EAAE,OAAO,WAAW;YAClB,wCAAwC;YACxC,QAAQ,GAAG,CAAC;QACd;QAEA,OAAO;IACT,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,sCAAsC;YAClD,MAAM,MAAM,IAAI;YAChB,MAAM,MAAM,IAAI;YAChB,SAAS,MAAM,OAAO;QACxB;QAEA,IAAI,eAAe;QAEnB,IAAI,MAAM,IAAI,KAAK,gCAAgC,MAAM,IAAI,KAAK,mCAAmC;YACnG,eAAe;QACjB,OAAO,IAAI,MAAM,IAAI,KAAK,+BAA+B;YACvD,eAAe;QACjB,OAAO,IAAI,MAAM,OAAO,EAAE;YACxB,eAAe,MAAM,OAAO;QAC9B;QAEA,MAAM,IAAI,MAAM;IAClB;AACF;AAEO,eAAe;IACpB,IAAI,CAAC,IAAA,kLAAe,KAAI;QACtB,MAAM,IAAI,MAAM;IAClB;IAEA,IAAI;QACF,MAAM,OAAO,IAAA,kLAAe;QAC5B,IAAI,CAAC,MAAM;YACT,MAAM,IAAI,MAAM;QAClB;QACA,MAAM,IAAA,iUAAO,EAAC;IAChB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,2BAA2B;QACzC,MAAM;IACR;AACF;AAEO,SAAS,aAAa,QAAqC;IAChE,IAAI,CAAC,IAAA,kLAAe,KAAI;QACtB,QAAQ,IAAI,CAAC;QACb,SAAS;QACT,OAAO,KAAO;IAChB;IAEA,IAAI;QACF,MAAM,OAAO,IAAA,kLAAe;QAC5B,IAAI,CAAC,MAAM;YACT,SAAS;YACT,OAAO,KAAO;QAChB;QACA,OAAO,IAAA,4UAAkB,EAAC,MAAM;IAClC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,wCAAwC;QACtD,SAAS;QACT,OAAO,KAAO;IAChB;AACF"}},
    {"offset": {"line": 468, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/hp/Downloads/anonymous-social-platform/components/app/header.tsx"],"sourcesContent":["'use client'\n\nimport Link from 'next/link'\nimport { ThemeToggle } from '@/components/theme-toggle'\nimport { useAuth } from '@/lib/auth-context'\nimport { signOutUser } from '@/lib/auth-service'\nimport { useState } from 'react'\n\nexport function Header() {\n  const { user, loading } = useAuth()\n  const [showMenu, setShowMenu] = useState(false)\n\n  const handleSignOut = async () => {\n    try {\n      await signOutUser()\n      setShowMenu(false)\n    } catch (error) {\n      console.error('[v0] Sign out error:', error)\n    }\n  }\n\n  return (\n    <header className=\"fixed top-0 left-0 right-0 z-40 flex items-center justify-between px-6 py-4 backdrop-blur-xl bg-dark-bg/50 border-b border-dark-border\">\n      <Link href=\"/\" className=\"flex items-center gap-2 text-2xl font-black gradient-text hover:opacity-80 transition\">\n        <span>üëª</span>\n        <span>BlurNote</span>\n      </Link>\n\n      <div className=\"flex items-center gap-4\">\n        <ThemeToggle />\n        {!loading && user && (\n          <div className=\"relative\">\n            <button\n              onClick={() => setShowMenu(!showMenu)}\n              className=\"w-10 h-10 rounded-full bg-gradient-to-br from-primary to-accent flex items-center justify-center text-lg hover:scale-110 transition\"\n            >\n              üë§\n            </button>\n            {showMenu && (\n              <div className=\"absolute top-12 right-0 bg-dark-card border border-dark-border rounded-lg shadow-xl overflow-hidden\">\n                <p className=\"px-4 py-2 text-sm text-gray-400 border-b border-dark-border truncate max-w-xs\">\n                  {user.displayName || 'Anonymous'}\n                </p>\n                <Link\n                  href={`/profile/${user.uid}`}\n                  className=\"block px-4 py-2 hover:bg-dark-secondary transition text-sm\"\n                  onClick={() => setShowMenu(false)}\n                >\n                  My Profile\n                </Link>\n                <button\n                  onClick={handleSignOut}\n                  className=\"w-full px-4 py-2 text-left hover:bg-dark-secondary transition text-sm\"\n                >\n                  Sign Out\n                </button>\n              </div>\n            )}\n          </div>\n        )}\n      </div>\n    </header>\n  )\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AANA;;;;;;;AAQO,SAAS;IACd,MAAM,EAAE,IAAI,EAAE,OAAO,EAAE,GAAG,IAAA,kLAAO;IACjC,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,0WAAQ,EAAC;IAEzC,MAAM,gBAAgB;QACpB,IAAI;YACF,MAAM,IAAA,qLAAW;YACjB,YAAY;QACd,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,wBAAwB;QACxC;IACF;IAEA,qBACE,uYAAC;QAAO,WAAU;;0BAChB,uYAAC,gUAAI;gBAAC,MAAK;gBAAI,WAAU;;kCACvB,uYAAC;kCAAK;;;;;;kCACN,uYAAC;kCAAK;;;;;;;;;;;;0BAGR,uYAAC;gBAAI,WAAU;;kCACb,uYAAC,6LAAW;;;;;oBACX,CAAC,WAAW,sBACX,uYAAC;wBAAI,WAAU;;0CACb,uYAAC;gCACC,SAAS,IAAM,YAAY,CAAC;gCAC5B,WAAU;0CACX;;;;;;4BAGA,0BACC,uYAAC;gCAAI,WAAU;;kDACb,uYAAC;wCAAE,WAAU;kDACV,KAAK,WAAW,IAAI;;;;;;kDAEvB,uYAAC,gUAAI;wCACH,MAAM,CAAC,SAAS,EAAE,KAAK,GAAG,EAAE;wCAC5B,WAAU;wCACV,SAAS,IAAM,YAAY;kDAC5B;;;;;;kDAGD,uYAAC;wCACC,SAAS;wCACT,WAAU;kDACX;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAUjB"}},
    {"offset": {"line": 602, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/hp/Downloads/anonymous-social-platform/lib/utils.ts"],"sourcesContent":["import { clsx, type ClassValue } from 'clsx'\nimport { twMerge } from 'tailwind-merge'\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,SAAS,GAAG,GAAG,MAAoB;IACxC,OAAO,IAAA,oRAAO,EAAC,IAAA,8OAAI,EAAC;AACtB"}},
    {"offset": {"line": 617, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/hp/Downloads/anonymous-social-platform/components/ui/dialog.tsx"],"sourcesContent":["'use client'\n\nimport * as React from 'react'\nimport * as DialogPrimitive from '@radix-ui/react-dialog'\nimport { XIcon } from 'lucide-react'\n\nimport { cn } from '@/lib/utils'\n\nfunction Dialog({\n  ...props\n}: React.ComponentProps<typeof DialogPrimitive.Root>) {\n  return <DialogPrimitive.Root data-slot=\"dialog\" {...props} />\n}\n\nfunction DialogTrigger({\n  ...props\n}: React.ComponentProps<typeof DialogPrimitive.Trigger>) {\n  return <DialogPrimitive.Trigger data-slot=\"dialog-trigger\" {...props} />\n}\n\nfunction DialogPortal({\n  ...props\n}: React.ComponentProps<typeof DialogPrimitive.Portal>) {\n  return <DialogPrimitive.Portal data-slot=\"dialog-portal\" {...props} />\n}\n\nfunction DialogClose({\n  ...props\n}: React.ComponentProps<typeof DialogPrimitive.Close>) {\n  return <DialogPrimitive.Close data-slot=\"dialog-close\" {...props} />\n}\n\nfunction DialogOverlay({\n  className,\n  ...props\n}: React.ComponentProps<typeof DialogPrimitive.Overlay>) {\n  return (\n    <DialogPrimitive.Overlay\n      data-slot=\"dialog-overlay\"\n      className={cn(\n        'data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50 backdrop-blur-xl',\n        className,\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction DialogContent({\n  className,\n  children,\n  showCloseButton = true,\n  ...props\n}: React.ComponentProps<typeof DialogPrimitive.Content> & {\n  showCloseButton?: boolean\n}) {\n  return (\n    <DialogPortal data-slot=\"dialog-portal\">\n      <DialogOverlay />\n      <DialogPrimitive.Content\n        data-slot=\"dialog-content\"\n        className={cn(\n          'bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg',\n          className,\n        )}\n        {...props}\n      >\n        {children}\n        {showCloseButton && (\n          <DialogPrimitive.Close\n            data-slot=\"dialog-close\"\n            className=\"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4\"\n          >\n            <XIcon />\n            <span className=\"sr-only\">Close</span>\n          </DialogPrimitive.Close>\n        )}\n      </DialogPrimitive.Content>\n    </DialogPortal>\n  )\n}\n\nfunction DialogHeader({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"dialog-header\"\n      className={cn('flex flex-col gap-2 text-center sm:text-left', className)}\n      {...props}\n    />\n  )\n}\n\nfunction DialogFooter({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"dialog-footer\"\n      className={cn(\n        'flex flex-col-reverse gap-2 sm:flex-row sm:justify-end',\n        className,\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction DialogTitle({\n  className,\n  ...props\n}: React.ComponentProps<typeof DialogPrimitive.Title>) {\n  return (\n    <DialogPrimitive.Title\n      data-slot=\"dialog-title\"\n      className={cn('text-lg leading-none font-semibold', className)}\n      {...props}\n    />\n  )\n}\n\nfunction DialogDescription({\n  className,\n  ...props\n}: React.ComponentProps<typeof DialogPrimitive.Description>) {\n  return (\n    <DialogPrimitive.Description\n      data-slot=\"dialog-description\"\n      className={cn('text-muted-foreground text-sm', className)}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Dialog,\n  DialogClose,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogOverlay,\n  DialogPortal,\n  DialogTitle,\n  DialogTrigger,\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAGA;AACA;AAEA;AANA;;;;;AAQA,SAAS,OAAO,EACd,GAAG,OAC+C;IAClD,qBAAO,uYAAC,uUAAoB;QAAC,aAAU;QAAU,GAAG,KAAK;;;;;;AAC3D;AAEA,SAAS,cAAc,EACrB,GAAG,OACkD;IACrD,qBAAO,uYAAC,0UAAuB;QAAC,aAAU;QAAkB,GAAG,KAAK;;;;;;AACtE;AAEA,SAAS,aAAa,EACpB,GAAG,OACiD;IACpD,qBAAO,uYAAC,yUAAsB;QAAC,aAAU;QAAiB,GAAG,KAAK;;;;;;AACpE;AAEA,SAAS,YAAY,EACnB,GAAG,OACgD;IACnD,qBAAO,uYAAC,wUAAqB;QAAC,aAAU;QAAgB,GAAG,KAAK;;;;;;AAClE;AAEA,SAAS,cAAc,EACrB,SAAS,EACT,GAAG,OACkD;IACrD,qBACE,uYAAC,0UAAuB;QACtB,aAAU;QACV,WAAW,IAAA,kKAAE,EACX,2KACA;QAED,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,cAAc,EACrB,SAAS,EACT,QAAQ,EACR,kBAAkB,IAAI,EACtB,GAAG,OAGJ;IACC,qBACE,uYAAC;QAAa,aAAU;;0BACtB,uYAAC;;;;;0BACD,uYAAC,0UAAuB;gBACtB,aAAU;gBACV,WAAW,IAAA,kKAAE,EACX,+WACA;gBAED,GAAG,KAAK;;oBAER;oBACA,iCACC,uYAAC,wUAAqB;wBACpB,aAAU;wBACV,WAAU;;0CAEV,uYAAC,6UAAK;;;;;0CACN,uYAAC;gCAAK,WAAU;0CAAU;;;;;;;;;;;;;;;;;;;;;;;;AAMtC;AAEA,SAAS,aAAa,EAAE,SAAS,EAAE,GAAG,OAAoC;IACxE,qBACE,uYAAC;QACC,aAAU;QACV,WAAW,IAAA,kKAAE,EAAC,gDAAgD;QAC7D,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,aAAa,EAAE,SAAS,EAAE,GAAG,OAAoC;IACxE,qBACE,uYAAC;QACC,aAAU;QACV,WAAW,IAAA,kKAAE,EACX,0DACA;QAED,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,YAAY,EACnB,SAAS,EACT,GAAG,OACgD;IACnD,qBACE,uYAAC,wUAAqB;QACpB,aAAU;QACV,WAAW,IAAA,kKAAE,EAAC,sCAAsC;QACnD,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,kBAAkB,EACzB,SAAS,EACT,GAAG,OACsD;IACzD,qBACE,uYAAC,8UAA2B;QAC1B,aAAU;QACV,WAAW,IAAA,kKAAE,EAAC,iCAAiC;QAC9C,GAAG,KAAK;;;;;;AAGf"}},
    {"offset": {"line": 799, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/hp/Downloads/anonymous-social-platform/app/actions/likes.ts"],"sourcesContent":["'use server'\r\n\r\nimport { getAdminDb } from '@/lib/firebase-admin'\r\nimport { Timestamp } from 'firebase-admin/firestore'\r\n\r\n/**\r\n * Toggle like on a post\r\n */\r\nexport async function toggleLike(userId: string, postId: string) {\r\n  try {\r\n    const db = getAdminDb()\r\n    \r\n    // Check if already liked\r\n    const likeRef = db.collection('posts').doc(postId).collection('likes').doc(userId)\r\n    const likeDoc = await likeRef.get()\r\n    \r\n    const postRef = db.collection('posts').doc(postId)\r\n    const postDoc = await postRef.get()\r\n    \r\n    if (!postDoc.exists) {\r\n      throw new Error('Post not found')\r\n    }\r\n    \r\n    const isLiked = likeDoc.exists\r\n    \r\n    if (isLiked) {\r\n      // Unlike: remove like document and decrement count\r\n      await likeRef.delete()\r\n      await postRef.update({\r\n        likesCount: (postDoc.data()!.likesCount || 0) - 1,\r\n      })\r\n      return { success: true, liked: false }\r\n    } else {\r\n      // Like: add like document and increment count\r\n      await likeRef.set({\r\n        createdAt: Timestamp.now(),\r\n      })\r\n      await postRef.update({\r\n        likesCount: (postDoc.data()!.likesCount || 0) + 1,\r\n      })\r\n      return { success: true, liked: true }\r\n    }\r\n  } catch (error: any) {\r\n    console.error('[Server] Error toggling like:', error)\r\n    throw error\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;;IAQsB,aAAA,WAAA,GAAA,IAAA,wYAAA,EAAA,8CAAA,6XAAA,EAAA,KAAA,GAAA,mYAAA,EAAA"}},
    {"offset": {"line": 811, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/hp/Downloads/anonymous-social-platform/app/actions/comments.ts"],"sourcesContent":["'use server'\r\n\r\nimport { getAdminDb, isShadowbanned } from '@/lib/firebase-admin'\r\nimport { Timestamp } from 'firebase-admin/firestore'\r\n\r\ninterface AddCommentParams {\r\n  postId: string\r\n  userId: string\r\n  content: string\r\n}\r\n\r\n/**\r\n * Convert Firestore Timestamp objects to plain JavaScript values\r\n * This is necessary because Timestamps can't be serialized when passing from server to client\r\n */\r\nfunction serializeTimestamp(value: any): any {\r\n  // Check if it's a Firestore Timestamp\r\n  if (value && typeof value === 'object' && 'toDate' in value && typeof value.toDate === 'function') {\r\n    return value.toDate().toISOString()\r\n  }\r\n  // Check if it's a Timestamp-like object with _seconds\r\n  if (value && typeof value === 'object' && '_seconds' in value) {\r\n    const seconds = value._seconds || 0\r\n    const nanoseconds = value._nanoseconds || 0\r\n    return new Date(seconds * 1000 + nanoseconds / 1000000).toISOString()\r\n  }\r\n  return value\r\n}\r\n\r\n/**\r\n * Recursively serialize all Timestamp objects in a data object\r\n */\r\nfunction serializeCommentData(data: any): any {\r\n  if (data === null || data === undefined) {\r\n    return data\r\n  }\r\n  \r\n  if (Array.isArray(data)) {\r\n    return data.map(item => serializeCommentData(item))\r\n  }\r\n  \r\n  if (typeof data === 'object') {\r\n    const serialized: any = {}\r\n    for (const [key, value] of Object.entries(data)) {\r\n      // Special handling for timestamp fields\r\n      if (key === 'createdAt' || key === 'updatedAt') {\r\n        serialized[key] = serializeTimestamp(value)\r\n      } else if (typeof value === 'object' && value !== null) {\r\n        serialized[key] = serializeCommentData(value)\r\n      } else {\r\n        serialized[key] = value\r\n      }\r\n    }\r\n    return serialized\r\n  }\r\n  \r\n  return data\r\n}\r\n\r\n/**\r\n * Add comment to a post\r\n */\r\nexport async function addComment(params: AddCommentParams) {\r\n  try {\r\n    const db = getAdminDb()\r\n    \r\n    // Check if user is shadowbanned\r\n    const shadowbanned = await isShadowbanned(params.userId)\r\n    if (shadowbanned) {\r\n      // Shadowbanned users can comment, but comments won't appear to others\r\n      // We'll handle this in the comments query\r\n    }\r\n    \r\n    // Get user data for denormalization\r\n    const userDoc = await db.collection('users').doc(params.userId).get()\r\n    if (!userDoc.exists) {\r\n      throw new Error('User not found')\r\n    }\r\n    \r\n    const userData = userDoc.data()!\r\n    \r\n    // Validate content\r\n    if (!params.content?.trim()) {\r\n      throw new Error('Comment content is required')\r\n    }\r\n    \r\n    // Check if post exists\r\n    const postRef = db.collection('posts').doc(params.postId)\r\n    const postDoc = await postRef.get()\r\n    \r\n    if (!postDoc.exists) {\r\n      throw new Error('Post not found')\r\n    }\r\n    \r\n    const postData = postDoc.data()!\r\n    if (postData.status !== 'active') {\r\n      throw new Error('Cannot comment on this post')\r\n    }\r\n    \r\n    // Add comment to subcollection\r\n    const commentRef = postRef.collection('comments').doc()\r\n    await commentRef.set({\r\n      userId: params.userId,\r\n      authorUsername: userData.username || 'Anonymous',\r\n      authorAvatarUrl: userData.avatarUrl || '',\r\n      content: params.content.trim(),\r\n      createdAt: Timestamp.now(),\r\n      status: 'active',\r\n    })\r\n    \r\n    // Increment comment count\r\n    await postRef.update({\r\n      commentsCount: (postData.commentsCount || 0) + 1,\r\n    })\r\n    \r\n    return { success: true, commentId: commentRef.id }\r\n  } catch (error: any) {\r\n    console.error('[Server] Error adding comment:', error)\r\n    throw error\r\n  }\r\n}\r\n\r\n/**\r\n * Get comments for a post (filtering out shadowbanned users)\r\n */\r\nexport async function getPostComments(postId: string) {\r\n  try {\r\n    const db = getAdminDb()\r\n    \r\n    // Get all users and identify shadowbanned ones\r\n    // Users without a status field or with status 'active' are considered active\r\n    const allUsersSnapshot = await db.collection('users').get()\r\n    const shadowbannedUserIds = new Set(\r\n      allUsersSnapshot.docs\r\n        .filter(doc => {\r\n          const userData = doc.data()\r\n          return userData.status === 'shadowbanned'\r\n        })\r\n        .map(doc => doc.id)\r\n    )\r\n    \r\n    // Get comments\r\n    const commentsSnapshot = await db.collection('posts')\r\n      .doc(postId)\r\n      .collection('comments')\r\n      .where('status', '==', 'active')\r\n      .orderBy('createdAt', 'desc')\r\n      .get()\r\n    \r\n    // Filter out shadowbanned users\r\n    const comments = commentsSnapshot.docs\r\n      .map(doc => ({\r\n        id: doc.id,\r\n        ...doc.data(),\r\n      }))\r\n      .filter((comment: any) => {\r\n        // Only show comments from active (non-shadowbanned) users\r\n        return !shadowbannedUserIds.has(comment.userId)\r\n      })\r\n    \r\n    // Serialize all comments to convert Timestamps to plain values\r\n    return comments.map(comment => serializeCommentData(comment))\r\n  } catch (error: any) {\r\n    console.error('[Server] Error getting comments:', error)\r\n    return []\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;;IA6HsB,kBAAA,WAAA,GAAA,IAAA,wYAAA,EAAA,8CAAA,6XAAA,EAAA,KAAA,GAAA,mYAAA,EAAA"}},
    {"offset": {"line": 823, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/hp/Downloads/anonymous-social-platform/app/actions/comments.ts"],"sourcesContent":["'use server'\r\n\r\nimport { getAdminDb, isShadowbanned } from '@/lib/firebase-admin'\r\nimport { Timestamp } from 'firebase-admin/firestore'\r\n\r\ninterface AddCommentParams {\r\n  postId: string\r\n  userId: string\r\n  content: string\r\n}\r\n\r\n/**\r\n * Convert Firestore Timestamp objects to plain JavaScript values\r\n * This is necessary because Timestamps can't be serialized when passing from server to client\r\n */\r\nfunction serializeTimestamp(value: any): any {\r\n  // Check if it's a Firestore Timestamp\r\n  if (value && typeof value === 'object' && 'toDate' in value && typeof value.toDate === 'function') {\r\n    return value.toDate().toISOString()\r\n  }\r\n  // Check if it's a Timestamp-like object with _seconds\r\n  if (value && typeof value === 'object' && '_seconds' in value) {\r\n    const seconds = value._seconds || 0\r\n    const nanoseconds = value._nanoseconds || 0\r\n    return new Date(seconds * 1000 + nanoseconds / 1000000).toISOString()\r\n  }\r\n  return value\r\n}\r\n\r\n/**\r\n * Recursively serialize all Timestamp objects in a data object\r\n */\r\nfunction serializeCommentData(data: any): any {\r\n  if (data === null || data === undefined) {\r\n    return data\r\n  }\r\n  \r\n  if (Array.isArray(data)) {\r\n    return data.map(item => serializeCommentData(item))\r\n  }\r\n  \r\n  if (typeof data === 'object') {\r\n    const serialized: any = {}\r\n    for (const [key, value] of Object.entries(data)) {\r\n      // Special handling for timestamp fields\r\n      if (key === 'createdAt' || key === 'updatedAt') {\r\n        serialized[key] = serializeTimestamp(value)\r\n      } else if (typeof value === 'object' && value !== null) {\r\n        serialized[key] = serializeCommentData(value)\r\n      } else {\r\n        serialized[key] = value\r\n      }\r\n    }\r\n    return serialized\r\n  }\r\n  \r\n  return data\r\n}\r\n\r\n/**\r\n * Add comment to a post\r\n */\r\nexport async function addComment(params: AddCommentParams) {\r\n  try {\r\n    const db = getAdminDb()\r\n    \r\n    // Check if user is shadowbanned\r\n    const shadowbanned = await isShadowbanned(params.userId)\r\n    if (shadowbanned) {\r\n      // Shadowbanned users can comment, but comments won't appear to others\r\n      // We'll handle this in the comments query\r\n    }\r\n    \r\n    // Get user data for denormalization\r\n    const userDoc = await db.collection('users').doc(params.userId).get()\r\n    if (!userDoc.exists) {\r\n      throw new Error('User not found')\r\n    }\r\n    \r\n    const userData = userDoc.data()!\r\n    \r\n    // Validate content\r\n    if (!params.content?.trim()) {\r\n      throw new Error('Comment content is required')\r\n    }\r\n    \r\n    // Check if post exists\r\n    const postRef = db.collection('posts').doc(params.postId)\r\n    const postDoc = await postRef.get()\r\n    \r\n    if (!postDoc.exists) {\r\n      throw new Error('Post not found')\r\n    }\r\n    \r\n    const postData = postDoc.data()!\r\n    if (postData.status !== 'active') {\r\n      throw new Error('Cannot comment on this post')\r\n    }\r\n    \r\n    // Add comment to subcollection\r\n    const commentRef = postRef.collection('comments').doc()\r\n    await commentRef.set({\r\n      userId: params.userId,\r\n      authorUsername: userData.username || 'Anonymous',\r\n      authorAvatarUrl: userData.avatarUrl || '',\r\n      content: params.content.trim(),\r\n      createdAt: Timestamp.now(),\r\n      status: 'active',\r\n    })\r\n    \r\n    // Increment comment count\r\n    await postRef.update({\r\n      commentsCount: (postData.commentsCount || 0) + 1,\r\n    })\r\n    \r\n    return { success: true, commentId: commentRef.id }\r\n  } catch (error: any) {\r\n    console.error('[Server] Error adding comment:', error)\r\n    throw error\r\n  }\r\n}\r\n\r\n/**\r\n * Get comments for a post (filtering out shadowbanned users)\r\n */\r\nexport async function getPostComments(postId: string) {\r\n  try {\r\n    const db = getAdminDb()\r\n    \r\n    // Get all users and identify shadowbanned ones\r\n    // Users without a status field or with status 'active' are considered active\r\n    const allUsersSnapshot = await db.collection('users').get()\r\n    const shadowbannedUserIds = new Set(\r\n      allUsersSnapshot.docs\r\n        .filter(doc => {\r\n          const userData = doc.data()\r\n          return userData.status === 'shadowbanned'\r\n        })\r\n        .map(doc => doc.id)\r\n    )\r\n    \r\n    // Get comments\r\n    const commentsSnapshot = await db.collection('posts')\r\n      .doc(postId)\r\n      .collection('comments')\r\n      .where('status', '==', 'active')\r\n      .orderBy('createdAt', 'desc')\r\n      .get()\r\n    \r\n    // Filter out shadowbanned users\r\n    const comments = commentsSnapshot.docs\r\n      .map(doc => ({\r\n        id: doc.id,\r\n        ...doc.data(),\r\n      }))\r\n      .filter((comment: any) => {\r\n        // Only show comments from active (non-shadowbanned) users\r\n        return !shadowbannedUserIds.has(comment.userId)\r\n      })\r\n    \r\n    // Serialize all comments to convert Timestamps to plain values\r\n    return comments.map(comment => serializeCommentData(comment))\r\n  } catch (error: any) {\r\n    console.error('[Server] Error getting comments:', error)\r\n    return []\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;;IA8DsB,aAAA,WAAA,GAAA,IAAA,wYAAA,EAAA,8CAAA,6XAAA,EAAA,KAAA,GAAA,mYAAA,EAAA"}},
    {"offset": {"line": 835, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/hp/Downloads/anonymous-social-platform/components/app/comments-modal.tsx"],"sourcesContent":["'use client'\n\nimport { useEffect, useState } from 'react'\nimport { getPostComments, addComment as addCommentAction } from '@/app/actions/comments'\nimport { useAuth } from '@/lib/auth-context'\n\ninterface CommentsModalProps {\n  postId: string\n  onClose: () => void\n}\n\nexport function CommentsModal({ postId, onClose }: CommentsModalProps) {\n  const { user } = useAuth()\n  const [comments, setComments] = useState<any[]>([])\n  const [newComment, setNewComment] = useState('')\n  const [loading, setLoading] = useState(true)\n  const [submitting, setSubmitting] = useState(false)\n  const [error, setError] = useState('')\n\n  useEffect(() => {\n    const loadComments = async () => {\n      try {\n        if (postId.startsWith('demo-')) {\n          setComments([])\n          setLoading(false)\n          return\n        }\n\n        const postComments = await getPostComments(postId)\n        setComments(postComments)\n      } catch (err) {\n        console.error('[v0] Error loading comments:', err)\n      } finally {\n        setLoading(false)\n      }\n    }\n\n    loadComments()\n  }, [postId])\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n\n    if (!newComment.trim() || !user) return\n\n    if (postId.startsWith('demo-')) {\n      setError('Sign in to comment on real posts!')\n      return\n    }\n\n    try {\n      setSubmitting(true)\n      setError('')\n\n      await addCommentAction({\n        postId,\n        userId: user.uid,\n        content: newComment.trim(),\n      })\n\n      setNewComment('')\n\n      // Reload comments\n      const updatedComments = await getPostComments(postId)\n      setComments(updatedComments)\n    } catch (err: any) {\n      setError(err.message || 'Failed to post comment')\n    } finally {\n      setSubmitting(false)\n    }\n  }\n\n  const timeAgo = (date: any) => {\n    try {\n      const now = new Date()\n      const commentDate = date?.toDate?.() || new Date(date)\n      const diff = now.getTime() - commentDate.getTime()\n      const hours = Math.floor(diff / (1000 * 60 * 60))\n      if (hours < 1) return 'just now'\n      if (hours < 24) return `${hours}h ago`\n      return `${Math.floor(hours / 24)}d ago`\n    } catch {\n      return 'recently'\n    }\n  }\n\n  return (\n    <div className=\"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\n      <div className=\"bg-dark-card border border-dark-border rounded-2xl w-full max-w-2xl max-h-screen overflow-hidden flex flex-col\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between p-6 border-b border-dark-border\">\n          <h2 className=\"text-2xl font-bold\">Comments</h2>\n          <button\n            onClick={onClose}\n            className=\"text-gray-400 hover:text-white text-2xl transition\"\n          >\n            ‚úï\n          </button>\n        </div>\n\n        {/* Comments List */}\n        <div className=\"flex-1 overflow-y-auto p-6 space-y-4\">\n          {loading ? (\n            <div className=\"text-center py-8\">\n              <p className=\"text-gray-400\">Loading comments...</p>\n            </div>\n          ) : comments.length === 0 ? (\n            <div className=\"text-center py-8\">\n              <p className=\"text-gray-400\">No comments yet. Be the first!</p>\n            </div>\n          ) : (\n            comments.map((comment) => (\n              <div key={comment.id} className=\"flex gap-3 pb-4 border-b border-dark-border last:border-b-0\">\n                <div className=\"w-10 h-10 rounded-full bg-gradient-to-br from-primary to-accent flex-shrink-0 flex items-center justify-center text-sm\">\n                  üë§\n                </div>\n                <div className=\"flex-1\">\n                  <div className=\"flex items-center gap-2\">\n                    <p className=\"font-semibold text-sm\">{comment.authorUsername || 'Anonymous'}</p>\n                    <p className=\"text-xs text-gray-400\">{timeAgo(comment.createdAt)}</p>\n                  </div>\n                  <p className=\"text-sm text-gray-200 mt-1\">{comment.content}</p>\n                </div>\n              </div>\n            ))\n          )}\n        </div>\n\n        {/* Comment Input */}\n        {user ? (\n          <div className=\"border-t border-dark-border p-6 bg-dark-secondary/50\">\n            {error && (\n              <p className=\"text-error text-sm mb-3\">{error}</p>\n            )}\n            <form onSubmit={handleSubmit} className=\"flex gap-3\">\n              <input\n                type=\"text\"\n                value={newComment}\n                onChange={(e) => setNewComment(e.target.value)}\n                placeholder=\"Add a comment...\"\n                disabled={submitting}\n                className=\"flex-1 bg-dark-card border border-dark-border rounded-lg px-4 py-2 text-white placeholder-gray-500 focus:outline-none focus:border-primary transition disabled:opacity-50\"\n              />\n              <button\n                type=\"submit\"\n                disabled={!newComment.trim() || submitting}\n                className=\"btn-primary px-6 py-2 disabled:opacity-50\"\n              >\n                {submitting ? '...' : 'Post'}\n              </button>\n            </form>\n          </div>\n        ) : (\n          <div className=\"border-t border-dark-border p-6 bg-dark-secondary/50 text-center text-gray-400 text-sm\">\n            Sign in to comment\n          </div>\n        )}\n      </div>\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1111, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/hp/Downloads/anonymous-social-platform/lib/genre-styles.ts"],"sourcesContent":["/**\r\n * Genre color mapping and styling helper\r\n * Used for dynamic post card styling based on genre\r\n */\r\n\r\nexport type Genre = \r\n  | 'Confession'\r\n  | 'Motivation'\r\n  | 'Love / Heartbreak'\r\n  | 'Dark Thoughts'\r\n  | 'Friendship'\r\n  | 'Life Advice'\r\n  | 'Humor'\r\n  | 'Storytime'\r\n\r\nexport const GENRES: Genre[] = [\r\n  'Confession',\r\n  'Motivation',\r\n  'Love / Heartbreak',\r\n  'Dark Thoughts',\r\n  'Friendship',\r\n  'Life Advice',\r\n  'Humor',\r\n  'Storytime',\r\n]\r\n\r\nexport const GENRE_COLORS: Record<Genre, string> = {\r\n  'Confession': '#FF6B6B',\r\n  'Motivation': '#6BCB77',\r\n  'Love / Heartbreak': '#A66CFF',\r\n  'Dark Thoughts': '#FF4C4C',\r\n  'Friendship': '#4D96FF',\r\n  'Life Advice': '#FFD93D',\r\n  'Humor': '#FF9F1C',\r\n  'Storytime': '#845EC2',\r\n}\r\n\r\n/**\r\n * Get dynamic styles for a genre\r\n * Dark Thoughts has special styling (dark bg + red border)\r\n */\r\nexport function getGenreStyles(genre: string): string {\r\n  switch (genre) {\r\n    case 'Dark Thoughts':\r\n      return 'bg-[#2D2D2D] border-2 border-[#FF4C4C]'\r\n    case 'Confession':\r\n      return 'bg-[#FF6B6B]'\r\n    case 'Motivation':\r\n      return 'bg-[#6BCB77]'\r\n    case 'Love / Heartbreak':\r\n      return 'bg-[#A66CFF]'\r\n    case 'Friendship':\r\n      return 'bg-[#4D96FF]'\r\n    case 'Life Advice':\r\n      return 'bg-[#FFD93D]'\r\n    case 'Humor':\r\n      return 'bg-[#FF9F1C]'\r\n    case 'Storytime':\r\n      return 'bg-[#845EC2]'\r\n    default:\r\n      return 'bg-dark-card border border-dark-border'\r\n  }\r\n}\r\n\r\n/**\r\n * Get genre color for text or other uses\r\n */\r\nexport function getGenreColor(genre: string): string {\r\n  return GENRE_COLORS[genre as Genre] || '#8b5cf6'\r\n}\r\n\r\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;;;;;;;AAYM,MAAM,SAAkB;IAC7B;IACA;IACA;IACA;IACA;IACA;IACA;IACA;CACD;AAEM,MAAM,eAAsC;IACjD,cAAc;IACd,cAAc;IACd,qBAAqB;IACrB,iBAAiB;IACjB,cAAc;IACd,eAAe;IACf,SAAS;IACT,aAAa;AACf;AAMO,SAAS,eAAe,KAAa;IAC1C,OAAQ;QACN,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QACT;YACE,OAAO;IACX;AACF;AAKO,SAAS,cAAc,KAAa;IACzC,OAAO,YAAY,CAAC,MAAe,IAAI;AACzC"}},
    {"offset": {"line": 1173, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/hp/Downloads/anonymous-social-platform/app/actions/reports.ts"],"sourcesContent":["'use server'\r\n\r\nimport { getAdminDb } from '@/lib/firebase-admin'\r\nimport { Timestamp } from 'firebase-admin/firestore'\r\n\r\n/**\r\n * Report a post\r\n * Appends to reports[] array and sets reported = true\r\n */\r\nexport async function reportPost(postId: string, userId: string, reason: string) {\r\n  try {\r\n    const db = getAdminDb()\r\n    \r\n    // Check if post exists\r\n    const postDoc = await db.collection('posts').doc(postId).get()\r\n    if (!postDoc.exists) {\r\n      throw new Error('Post not found')\r\n    }\r\n    \r\n    const postData = postDoc.data()!\r\n    \r\n    // Check if user already reported this post\r\n    const existingReport = postData.reports?.find(\r\n      (r: any) => r.userId === userId\r\n    )\r\n    \r\n    if (existingReport) {\r\n      throw new Error('You have already reported this post')\r\n    }\r\n    \r\n    // Append to reports array and set reported = true\r\n    const reports = postData.reports || []\r\n    reports.push({\r\n      type: reason,\r\n      userId,\r\n      createdAt: Timestamp.now(),\r\n    })\r\n    \r\n    await db.collection('posts').doc(postId).update({\r\n      reported: true,\r\n      reports,\r\n    })\r\n    \r\n    return { success: true }\r\n  } catch (error: any) {\r\n    console.error('[Server] Error reporting post:', error)\r\n    throw error\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;;IASsB,aAAA,WAAA,GAAA,IAAA,wYAAA,EAAA,8CAAA,6XAAA,EAAA,KAAA,GAAA,mYAAA,EAAA"}},
    {"offset": {"line": 1185, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/hp/Downloads/anonymous-social-platform/components/app/report-modal.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useState } from 'react'\r\nimport { useAuth } from '@/lib/auth-context'\r\nimport { reportPost } from '@/app/actions/reports'\r\nimport { toast } from 'sonner'\r\n\r\ninterface ReportModalProps {\r\n  postId: string\r\n  onClose: () => void\r\n}\r\n\r\nconst REPORT_REASONS = [\r\n  'Abuse',\r\n  'Hate Speech',\r\n  'Self-Harm',\r\n  'Spam',\r\n]\r\n\r\nexport function ReportModal({ postId, onClose }: ReportModalProps) {\r\n  const { user } = useAuth()\r\n  const [selectedReason, setSelectedReason] = useState<string>('')\r\n  const [loading, setLoading] = useState(false)\r\n\r\n  const handleSubmit = async () => {\r\n    if (!user) {\r\n      toast.error('You must be logged in to report')\r\n      return\r\n    }\r\n\r\n    if (!selectedReason) {\r\n      toast.error('Please select a reason')\r\n      return\r\n    }\r\n\r\n    try {\r\n      setLoading(true)\r\n      await reportPost(postId, user.uid, selectedReason)\r\n      toast.success('Report submitted')\r\n      onClose()\r\n    } catch (error: any) {\r\n      toast.error(error.message || 'Failed to submit report')\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\r\n      <div className=\"bg-dark-card border border-dark-border rounded-2xl w-full max-w-md\">\r\n        <div className=\"p-6 space-y-4\">\r\n          <h2 className=\"text-2xl font-bold\">Report Post</h2>\r\n          <p className=\"text-sm text-gray-400\">\r\n            Why are you reporting this post?\r\n          </p>\r\n\r\n          <div className=\"space-y-2\">\r\n            {REPORT_REASONS.map((reason) => (\r\n              <button\r\n                key={reason}\r\n                onClick={() => setSelectedReason(reason)}\r\n                className={`w-full px-4 py-3 rounded-lg text-left transition ${\r\n                  selectedReason === reason\r\n                    ? 'bg-primary text-white'\r\n                    : 'bg-dark-secondary text-gray-300 hover:bg-dark-card'\r\n                }`}\r\n              >\r\n                {reason}\r\n              </button>\r\n            ))}\r\n          </div>\r\n\r\n          <div className=\"flex gap-3 pt-4\">\r\n            <button\r\n              onClick={onClose}\r\n              disabled={loading}\r\n              className=\"flex-1 py-3 bg-dark-secondary border border-dark-border rounded-lg font-semibold hover:border-error hover:text-error transition disabled:opacity-50\"\r\n            >\r\n              Cancel\r\n            </button>\r\n            <button\r\n              onClick={handleSubmit}\r\n              disabled={!selectedReason || loading}\r\n              className=\"flex-1 py-3 bg-error text-white rounded-lg font-semibold hover:bg-error/90 transition disabled:opacity-50 disabled:cursor-not-allowed\"\r\n            >\r\n              {loading ? 'Submitting...' : 'Submit Report'}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AALA;;;;;;AAYA,MAAM,iBAAiB;IACrB;IACA;IACA;IACA;CACD;AAEM,SAAS,YAAY,EAAE,MAAM,EAAE,OAAO,EAAoB;IAC/D,MAAM,EAAE,IAAI,EAAE,GAAG,IAAA,kLAAO;IACxB,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,0WAAQ,EAAS;IAC7D,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,0WAAQ,EAAC;IAEvC,MAAM,eAAe;QACnB,IAAI,CAAC,MAAM;YACT,iUAAK,CAAC,KAAK,CAAC;YACZ;QACF;QAEA,IAAI,CAAC,gBAAgB;YACnB,iUAAK,CAAC,KAAK,CAAC;YACZ;QACF;QAEA,IAAI;YACF,WAAW;YACX,MAAM,IAAA,oNAAU,EAAC,QAAQ,KAAK,GAAG,EAAE;YACnC,iUAAK,CAAC,OAAO,CAAC;YACd;QACF,EAAE,OAAO,OAAY;YACnB,iUAAK,CAAC,KAAK,CAAC,MAAM,OAAO,IAAI;QAC/B,SAAU;YACR,WAAW;QACb;IACF;IAEA,qBACE,uYAAC;QAAI,WAAU;kBACb,cAAA,uYAAC;YAAI,WAAU;sBACb,cAAA,uYAAC;gBAAI,WAAU;;kCACb,uYAAC;wBAAG,WAAU;kCAAqB;;;;;;kCACnC,uYAAC;wBAAE,WAAU;kCAAwB;;;;;;kCAIrC,uYAAC;wBAAI,WAAU;kCACZ,eAAe,GAAG,CAAC,CAAC,uBACnB,uYAAC;gCAEC,SAAS,IAAM,kBAAkB;gCACjC,WAAW,CAAC,iDAAiD,EAC3D,mBAAmB,SACf,0BACA,sDACJ;0CAED;+BARI;;;;;;;;;;kCAaX,uYAAC;wBAAI,WAAU;;0CACb,uYAAC;gCACC,SAAS;gCACT,UAAU;gCACV,WAAU;0CACX;;;;;;0CAGD,uYAAC;gCACC,SAAS;gCACT,UAAU,CAAC,kBAAkB;gCAC7B,WAAU;0CAET,UAAU,kBAAkB;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAO3C"}},
    {"offset": {"line": 1319, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/hp/Downloads/anonymous-social-platform/components/app/post-card.tsx"],"sourcesContent":["'use client'\n\nimport Link from 'next/link'\nimport { useState, useRef, useEffect, useCallback } from 'react'\nimport WaveSurfer from 'wavesurfer.js'\nimport { motion } from 'framer-motion'\nimport { Dialog, DialogContent } from '@/components/ui/dialog'\nimport { useAuth } from '@/lib/auth-context'\nimport { toggleLike } from '@/app/actions/likes'\nimport { CommentsModal } from './comments-modal'\nimport { getGenreStyles } from '@/lib/genre-styles'\nimport { ReportModal } from './report-modal'\n\ninterface PostCardProps {\n  post: any\n  isLiked: boolean\n  onLike: () => void\n}\n\ninterface VoicePlayerProps {\n  src: string\n  waveform?: number[] | null\n  duration?: number | null\n  initialSpeed?: number\n}\n\ninterface TextModalProps {\n  open: boolean\n  onOpenChange: (open: boolean) => void\n  text: string\n}\n\n// Global audio player state to ensure only one plays at a time\nlet currentPlayer: WaveSurfer | null = null\n\nfunction VoicePlayer({ src, waveform, duration, initialSpeed = 1 }: VoicePlayerProps) {\n  const containerRef = useRef<HTMLDivElement | null>(null)\n  const wavesurferRef = useRef<WaveSurfer | null>(null)\n  const [isPlaying, setIsPlaying] = useState(false)\n  const [speed, setSpeed] = useState(initialSpeed || 1)\n  const [initError, setInitError] = useState<string | null>(null)\n\n  const createWaveSurfer = useCallback(async () => {\n    if (wavesurferRef.current || !containerRef.current || !src) return\n\n    try {\n      const ws = WaveSurfer.create({\n        container: containerRef.current,\n        waveColor: '#4b5563',\n        progressColor: '#a855f7',\n        cursorColor: 'transparent',\n        barWidth: 2,\n        barRadius: 2,\n        responsive: true,\n        height: 56,\n        // Use precomputed waveform if available\n        ...(waveform && { peaks: waveform }),\n      })\n\n      wavesurferRef.current = ws\n      \n      // If waveform is provided, use it directly (instant render)\n      // Otherwise, load from audio file\n      if (waveform && waveform.length > 0) {\n        // Create a dummy audio buffer for waveform display\n        // WaveSurfer will use the peaks we provided\n        ws.load(src)\n      } else {\n        ws.load(src)\n      }\n      \n      ws.setPlaybackRate(speed)\n\n      const handleFinish = () => {\n        setIsPlaying(false)\n        if (currentPlayer === ws) {\n          currentPlayer = null\n        }\n      }\n      ws.on('finish', handleFinish)\n      \n      const handlePause = () => {\n        setIsPlaying(false)\n        if (currentPlayer === ws) {\n          currentPlayer = null\n        }\n      }\n      ws.on('pause', handlePause)\n\n      return () => {\n        ws.un('finish', handleFinish)\n      }\n    } catch (e) {\n      console.error('Error initializing WaveSurfer', e)\n      setInitError('Could not initialize audio player')\n    }\n  }, [src, speed, waveform])\n\n  useEffect(() => {\n    return () => {\n      if (wavesurferRef.current) {\n        wavesurferRef.current.destroy()\n        wavesurferRef.current = null\n      }\n    }\n  }, [])\n\n  useEffect(() => {\n    if (wavesurferRef.current) {\n      wavesurferRef.current.setPlaybackRate(speed)\n    }\n  }, [speed])\n\n  const togglePlay = async () => {\n    if (!wavesurferRef.current) {\n      await createWaveSurfer()\n    }\n    if (!wavesurferRef.current) return\n\n    // Pause any currently playing audio\n    if (currentPlayer && currentPlayer !== wavesurferRef.current) {\n      currentPlayer.pause()\n    }\n\n    wavesurferRef.current.playPause()\n    setIsPlaying((prev) => {\n      const newState = !prev\n      if (newState) {\n        currentPlayer = wavesurferRef.current\n      } else {\n        currentPlayer = null\n      }\n      return newState\n    })\n  }\n\n  const handleSpeedChange = (value: number) => {\n    setSpeed(value)\n  }\n\n  const speeds = [1, 1.25, 1.5]\n\n  const formatDuration = (seconds: number | null | undefined) => {\n    if (!seconds) return '0:00'\n    const mins = Math.floor(seconds / 60)\n    const secs = Math.floor(seconds % 60)\n    return `${mins}:${secs.toString().padStart(2, '0')}`\n  }\n\n  return (\n    <div className=\"bg-gradient-to-r from-primary/20 to-accent/20 border border-primary/20 rounded-xl p-4\">\n      <div className=\"flex flex-col sm:flex-row items-center gap-3 sm:gap-4\">\n        <motion.button\n          whileHover={{ scale: 1.05 }}\n          whileTap={{ scale: 0.95 }}\n          onClick={togglePlay}\n          className=\"w-12 h-12 rounded-full bg-primary flex items-center justify-center text-xl shadow-lg hover:shadow-primary/50 transition\"\n        >\n          {isPlaying ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è'}\n        </motion.button>\n        <div className=\"flex-1 w-full\">\n          <div ref={containerRef} className=\"w-full h-12 sm:h-14\" />\n        </div>\n        {duration && (\n          <span className=\"text-xs text-gray-300 font-mono\">\n            {formatDuration(duration)}\n          </span>\n        )}\n      </div>\n      <div className=\"mt-3 flex flex-wrap items-center justify-between gap-2 text-xs sm:text-sm text-gray-200\">\n        <span className=\"opacity-80\">Playback speed</span>\n        <div className=\"flex gap-2\">\n          {speeds.map((s) => (\n            <button\n              key={s}\n              onClick={() => handleSpeedChange(s)}\n              className={`px-2 py-1 rounded-full border text-xs sm:text-sm transition ${\n                speed === s\n                  ? 'bg-primary text-white border-primary'\n                  : 'border-dark-border text-gray-300 hover:border-primary'\n              }`}\n            >\n              {s}x\n            </button>\n          ))}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction TextModal({ open, onOpenChange, text }: TextModalProps) {\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"glass border-dark-border w-[90%] sm:w-[70%] lg:w-1/2 max-h-[90vh] overflow-y-auto p-6\">\n        <motion.div\n          initial={{ opacity: 0, y: 16, scale: 0.96 }}\n          animate={{ opacity: 1, y: 0, scale: 1 }}\n          transition={{ duration: 0.2 }}\n          className=\"space-y-4\"\n        >\n          <p className=\"text-base sm:text-lg leading-relaxed text-gray-100\">{text}</p>\n        </motion.div>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nexport function PostCard({ post, isLiked, onLike }: PostCardProps) {\n  const { user } = useAuth()\n  const [showComments, setShowComments] = useState(false)\n  const [showTextModal, setShowTextModal] = useState(false)\n  const [showReportModal, setShowReportModal] = useState(false)\n  const [showMenu, setShowMenu] = useState(false)\n  const [liked, setLiked] = useState(isLiked)\n  const [likeCount, setLikeCount] = useState(post.likesCount || 0)\n  const [isLiking, setIsLiking] = useState(false)\n  const isOwnPost = user?.uid === post.userId\n\n  const isTextPost = post.type === 'text' && typeof post.content === 'string'\n  const isLongText = isTextPost && post.content.length > 150\n  const truncatedText = isLongText ? `${post.content.slice(0, 150)}...` : post.content\n\n  const timeAgo = (date: Date | any) => {\n    try {\n      const now = new Date()\n      const postDate = date?.toDate?.() || new Date(date)\n      const diff = now.getTime() - postDate.getTime()\n      const hours = Math.floor(diff / (1000 * 60 * 60))\n      if (hours < 1) return 'just now'\n      if (hours < 24) return `${hours}h ago`\n      return `${Math.floor(hours / 24)}d ago`\n    } catch {\n      return 'recently'\n    }\n  }\n\n  const handleLike = async () => {\n    if (!user || post.id.startsWith('demo-') || isLiking) return\n\n    try {\n      setIsLiking(true)\n      // Optimistic update\n      const newLiked = !liked\n      setLiked(newLiked)\n      setLikeCount(prev => newLiked ? prev + 1 : prev - 1)\n\n      // Call server action\n      const result = await toggleLike(user.uid, post.id)\n      \n      // Update state based on result\n      if (result.success) {\n        setLiked(result.liked)\n        // Update count from server response if needed\n      } else {\n        // Revert on error\n        setLiked(!newLiked)\n        setLikeCount(prev => newLiked ? prev - 1 : prev + 1)\n      }\n    } catch (error: any) {\n      console.error('[Server] Error toggling like:', error)\n      // Revert on error\n      setLiked(!liked)\n      setLikeCount(prev => liked ? prev - 1 : prev + 1)\n    } finally {\n      setIsLiking(false)\n    }\n  }\n\n  const profileLink = post.userId ? `/profile/${post.userId}` : '#'\n\n  // Get genre styles for dynamic styling\n  const genreStyles = post.genre ? getGenreStyles(post.genre) : 'bg-dark-card border border-dark-border'\n  const isDarkThoughts = post.genre === 'Dark Thoughts'\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ duration: 0.3 }}\n      className={`w-full ${genreStyles} ${!isDarkThoughts ? 'border border-dark-border' : ''} rounded-2xl overflow-hidden shadow-[0_20px_40px_rgba(0,0,0,0.35)] transition-transform duration-300 hover:-translate-y-1`}\n    >\n      {/* Header */}\n      <div className=\"flex items-center gap-3 px-4 sm:px-6 py-4 sm:py-5 border-b border-dark-border/60\">\n        <Link\n          href={profileLink}\n          className=\"w-12 h-12 rounded-full bg-gradient-to-br from-primary to-accent flex items-center justify-center text-xl hover:scale-110 transition\"\n        >\n          üëª\n        </Link>\n        <div>\n          <Link\n            href={profileLink}\n            className=\"font-semibold sm:font-bold hover:text-primary transition\"\n          >\n            {post.authorUsername || 'Anonymous'}\n          </Link>\n          <div className=\"flex items-center gap-2\">\n            <p className=\"text-xs sm:text-sm text-gray-400\">{timeAgo(post.createdAt)}</p>\n            {post.isEdited && (\n              <span className=\"text-xs text-gray-500 bg-dark-secondary px-2 py-0.5 rounded\">Edited</span>\n            )}\n          </div>\n        </div>\n      </div>\n\n      {/* Content + Audio + Actions */}\n      <div className=\"px-4 sm:px-6 py-4 sm:py-5\">\n        {/* Text content */}\n        {post.content && (\n          <div className=\"mb-3 sm:mb-4\">\n            <p className=\"text-sm sm:text-base text-gray-200 leading-relaxed\">\n              {isLongText ? truncatedText : post.content}\n            </p>\n            {isLongText && (\n              <button\n                onClick={() => setShowTextModal(true)}\n                className=\"mt-1 text-xs sm:text-sm text-primary hover:text-accent transition\"\n              >\n                ...read\n              </button>\n            )}\n          </div>\n        )}\n\n        {/* Audio Player for voice posts */}\n        {post.type === 'voice' && post.mediaUrl && (\n          <div className=\"mt-3 sm:mt-4\">\n            <VoicePlayer \n              src={post.mediaUrl} \n              waveform={post.waveform}\n              duration={post.mediaDuration}\n              initialSpeed={1} \n            />\n          </div>\n        )}\n\n        {/* Actions */}\n        <div className=\"mt-4 pt-4 border-t border-dark-border flex items-center gap-6 text-gray-400 text-xs sm:text-sm\">\n          <button\n            onClick={handleLike}\n            disabled={!user || post.id.startsWith('demo-') || isLiking}\n            className=\"flex items-center gap-2 hover:text-primary transition group disabled:opacity-50 disabled:cursor-not-allowed\"\n          >\n            <span className=\"text-lg sm:text-xl group-hover:scale-125 transition\">{liked ? '‚ù§Ô∏è' : 'ü§ç'}</span>\n            <span>{likeCount}</span>\n          </button>\n          <button\n            onClick={() => setShowComments(true)}\n            className=\"flex items-center gap-2 hover:text-primary transition\"\n          >\n            <span>üí¨</span>\n            <span>{post.commentCount || 0}</span>\n          </button>\n          {!isOwnPost && (\n            <button\n              onClick={() => setShowReportModal(true)}\n              className=\"flex items-center gap-2 hover:text-error transition\"\n              title=\"Report post\"\n            >\n              <span>üö©</span>\n            </button>\n          )}\n          {isOwnPost && (\n            <div className=\"relative\">\n              <button\n                onClick={() => setShowMenu(!showMenu)}\n                className=\"flex items-center gap-2 hover:text-primary transition\"\n                title=\"More options\"\n              >\n                <span>‚Ä¢‚Ä¢‚Ä¢</span>\n              </button>\n              {showMenu && (\n                <div className=\"absolute right-0 top-full mt-2 bg-dark-card border border-dark-border rounded-lg shadow-lg z-10 min-w-[120px]\">\n                  <button\n                    onClick={() => {\n                      setShowMenu(false)\n                      // TODO: Open edit modal\n                    }}\n                    className=\"w-full px-4 py-2 text-left text-sm hover:bg-dark-secondary transition\"\n                  >\n                    Edit\n                  </button>\n                  <button\n                    onClick={async () => {\n                      setShowMenu(false)\n                      // TODO: Delete post\n                    }}\n                    className=\"w-full px-4 py-2 text-left text-sm hover:bg-dark-secondary text-error transition\"\n                  >\n                    Delete\n                  </button>\n                </div>\n              )}\n            </div>\n          )}\n        </div>\n      </div>\n\n      {showComments && (\n        <CommentsModal postId={post.id} onClose={() => setShowComments(false)} />\n      )}\n\n      {isLongText && (\n        <TextModal\n          open={showTextModal}\n          onOpenChange={setShowTextModal}\n          text={post.content}\n        />\n      )}\n\n      {showReportModal && (\n        <ReportModal\n          postId={post.id}\n          onClose={() => setShowReportModal(false)}\n        />\n      )}\n    </motion.div>\n  )\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1948, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/hp/Downloads/anonymous-social-platform/components/app/post-card-skeleton.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { motion } from 'framer-motion'\r\n\r\nexport function PostCardSkeleton() {\r\n  return (\r\n    <motion.div\r\n      initial={{ opacity: 0, y: 20 }}\r\n      animate={{ opacity: 1, y: 0 }}\r\n      className=\"w-full bg-dark-card border border-dark-border rounded-2xl overflow-hidden\"\r\n    >\r\n      {/* Header Skeleton */}\r\n      <div className=\"flex items-center gap-3 px-4 sm:px-6 py-4 sm:py-5 border-b border-dark-border/60\">\r\n        <div className=\"w-12 h-12 rounded-full bg-dark-secondary animate-pulse\"></div>\r\n        <div className=\"flex-1 space-y-2\">\r\n          <div className=\"h-4 w-32 bg-dark-secondary rounded animate-pulse\"></div>\r\n          <div className=\"h-3 w-24 bg-dark-secondary rounded animate-pulse\"></div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Content Skeleton */}\r\n      <div className=\"px-4 sm:px-6 py-4 sm:py-5 space-y-4\">\r\n        <div className=\"space-y-2\">\r\n          <div className=\"h-4 w-full bg-dark-secondary rounded animate-pulse\"></div>\r\n          <div className=\"h-4 w-3/4 bg-dark-secondary rounded animate-pulse\"></div>\r\n        </div>\r\n\r\n        {/* Audio Player Skeleton (optional) */}\r\n        <div className=\"bg-dark-secondary rounded-xl p-4 animate-pulse\">\r\n          <div className=\"flex items-center gap-3\">\r\n            <div className=\"w-12 h-12 rounded-full bg-dark-card\"></div>\r\n            <div className=\"flex-1 h-12 bg-dark-card rounded\"></div>\r\n            <div className=\"h-6 w-12 bg-dark-card rounded\"></div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Actions Skeleton */}\r\n        <div className=\"mt-4 pt-4 border-t border-dark-border flex items-center gap-6\">\r\n          <div className=\"h-4 w-16 bg-dark-secondary rounded animate-pulse\"></div>\r\n          <div className=\"h-4 w-16 bg-dark-secondary rounded animate-pulse\"></div>\r\n        </div>\r\n      </div>\r\n    </motion.div>\r\n  )\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;AAEA;AAFA;;;AAIO,SAAS;IACd,qBACE,uYAAC,6VAAM,CAAC,GAAG;QACT,SAAS;YAAE,SAAS;YAAG,GAAG;QAAG;QAC7B,SAAS;YAAE,SAAS;YAAG,GAAG;QAAE;QAC5B,WAAU;;0BAGV,uYAAC;gBAAI,WAAU;;kCACb,uYAAC;wBAAI,WAAU;;;;;;kCACf,uYAAC;wBAAI,WAAU;;0CACb,uYAAC;gCAAI,WAAU;;;;;;0CACf,uYAAC;gCAAI,WAAU;;;;;;;;;;;;;;;;;;0BAKnB,uYAAC;gBAAI,WAAU;;kCACb,uYAAC;wBAAI,WAAU;;0CACb,uYAAC;gCAAI,WAAU;;;;;;0CACf,uYAAC;gCAAI,WAAU;;;;;;;;;;;;kCAIjB,uYAAC;wBAAI,WAAU;kCACb,cAAA,uYAAC;4BAAI,WAAU;;8CACb,uYAAC;oCAAI,WAAU;;;;;;8CACf,uYAAC;oCAAI,WAAU;;;;;;8CACf,uYAAC;oCAAI,WAAU;;;;;;;;;;;;;;;;;kCAKnB,uYAAC;wBAAI,WAAU;;0CACb,uYAAC;gCAAI,WAAU;;;;;;0CACf,uYAAC;gCAAI,WAAU;;;;;;;;;;;;;;;;;;;;;;;;AAKzB"}},
    {"offset": {"line": 2111, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/hp/Downloads/anonymous-social-platform/app/actions/feed.ts"],"sourcesContent":["'use server'\r\n\r\nimport { getAdminDb } from '@/lib/firebase-admin'\r\n\r\n/**\r\n * Convert Firestore Timestamp objects to plain JavaScript values\r\n * This is necessary because Timestamps can't be serialized when passing from server to client\r\n */\r\nfunction serializeTimestamp(value: any): any {\r\n  // Check if it's a Firestore Timestamp\r\n  if (value && typeof value === 'object' && 'toDate' in value && typeof value.toDate === 'function') {\r\n    return value.toDate().toISOString()\r\n  }\r\n  // Check if it's a Timestamp-like object with _seconds\r\n  if (value && typeof value === 'object' && '_seconds' in value) {\r\n    const seconds = value._seconds || 0\r\n    const nanoseconds = value._nanoseconds || 0\r\n    return new Date(seconds * 1000 + nanoseconds / 1000000).toISOString()\r\n  }\r\n  return value\r\n}\r\n\r\n/**\r\n * Recursively serialize all Timestamp objects in a data object\r\n */\r\nfunction serializePostData(data: any): any {\r\n  if (data === null || data === undefined) {\r\n    return data\r\n  }\r\n  \r\n  if (Array.isArray(data)) {\r\n    return data.map(item => serializePostData(item))\r\n  }\r\n  \r\n  if (typeof data === 'object') {\r\n    const serialized: any = {}\r\n    for (const [key, value] of Object.entries(data)) {\r\n      // Special handling for timestamp fields\r\n      if (key === 'createdAt' || key === 'updatedAt') {\r\n        serialized[key] = serializeTimestamp(value)\r\n      } else if (typeof value === 'object' && value !== null) {\r\n        serialized[key] = serializePostData(value)\r\n      } else {\r\n        serialized[key] = value\r\n      }\r\n    }\r\n    return serialized\r\n  }\r\n  \r\n  return data\r\n}\r\n\r\n/**\r\n * Get feed posts (filtering out shadowbanned users and hidden/deleted posts)\r\n * Supports genre filtering\r\n */\r\nexport async function getFeedPosts(\r\n  limitCount: number = 20,\r\n  lastPostId?: string,\r\n  genre?: string\r\n) {\r\n  try {\r\n    const db = getAdminDb()\r\n    \r\n    // Get all users and identify shadowbanned ones\r\n    // Users without a status field or with status 'active' are considered active\r\n    const allUsersSnapshot = await db.collection('users').get()\r\n    const shadowbannedUserIds = new Set(\r\n      allUsersSnapshot.docs\r\n        .filter(doc => {\r\n          const userData = doc.data()\r\n          return userData.status === 'shadowbanned'\r\n        })\r\n        .map(doc => doc.id)\r\n    )\r\n    \r\n    // Build query - query all posts ordered by createdAt\r\n    // We'll filter by genre and status in memory to avoid index requirements\r\n    let query: any = db.collection('posts')\r\n      .orderBy('createdAt', 'desc')\r\n      .limit(limitCount * 3) // Get more posts since we'll filter some out\r\n    \r\n    // If pagination cursor provided\r\n    if (lastPostId) {\r\n      const lastPostDoc = await db.collection('posts').doc(lastPostId).get()\r\n      if (lastPostDoc.exists) {\r\n        query = query.startAfter(lastPostDoc)\r\n      }\r\n    }\r\n    \r\n    let posts: any[] = []\r\n    try {\r\n      const snapshot = await query.get()\r\n      posts = snapshot.docs.map((doc: any) => ({\r\n        id: doc.id,\r\n        ...doc.data(),\r\n      }))\r\n    } catch (queryError: any) {\r\n      // If query fails (e.g., missing index), try a simpler query and sort in memory\r\n      console.warn('[Server] Query with orderBy failed, trying without orderBy:', queryError.message)\r\n      let fallbackQuery: any = db.collection('posts').limit(limitCount * 5)\r\n      const fallbackSnapshot = await fallbackQuery.get()\r\n      \r\n      posts = fallbackSnapshot.docs.map((doc: any) => ({\r\n        id: doc.id,\r\n        ...doc.data(),\r\n      }))\r\n      \r\n      // Sort in memory by createdAt (descending)\r\n      posts.sort((a: any, b: any) => {\r\n        const aTime = a.createdAt?.toMillis?.() || a.createdAt?._seconds || 0\r\n        const bTime = b.createdAt?.toMillis?.() || b.createdAt?._seconds || 0\r\n        return bTime - aTime // Descending order\r\n      })\r\n    }\r\n    \r\n    // Filter out shadowbanned users, inactive posts, and apply genre filter\r\n    const filteredPosts = posts\r\n      .filter((post: any) => {\r\n        // Exclude posts from shadowbanned users\r\n        if (shadowbannedUserIds.has(post.userId)) {\r\n          return false\r\n        }\r\n        \r\n        // Include posts with status 'active' or no status field (backward compatibility)\r\n        // Exclude posts with other statuses like 'deleted', 'hidden', etc.\r\n        if (post.status && post.status !== 'active') {\r\n          return false\r\n        }\r\n        \r\n        // Apply genre filter if specified\r\n        if (genre && genre !== 'All' && post.genre !== genre) {\r\n          return false\r\n        }\r\n        \r\n        return true\r\n      })\r\n      .slice(0, limitCount) // Limit to requested amount after filtering\r\n    \r\n    // Serialize all posts to convert Timestamps to plain values\r\n    return filteredPosts.map(post => serializePostData(post))\r\n  } catch (error: any) {\r\n    console.error('[Server] Error getting feed posts:', error)\r\n    return []\r\n  }\r\n}\r\n\r\n/**\r\n * Get user posts (for profile page)\r\n */\r\nexport async function getUserPosts(userId: string) {\r\n  try {\r\n    const db = getAdminDb()\r\n    \r\n    const snapshot = await db.collection('posts')\r\n      .where('userId', '==', userId)\r\n      .where('status', '==', 'active')\r\n      .orderBy('createdAt', 'desc')\r\n      .get()\r\n    \r\n    const posts = snapshot.docs.map(doc => ({\r\n      id: doc.id,\r\n      ...doc.data(),\r\n    }))\r\n    \r\n    // Serialize all posts to convert Timestamps to plain values\r\n    return posts.map(post => serializePostData(post))\r\n  } catch (error: any) {\r\n    console.error('[Server] Error getting user posts:', error)\r\n    return []\r\n  }\r\n}\r\n\r\n/**\r\n * Check if user has liked a post\r\n */\r\nexport async function checkUserLiked(userId: string, postId: string): Promise<boolean> {\r\n  try {\r\n    const db = getAdminDb()\r\n    const likeDoc = await db.collection('posts')\r\n      .doc(postId)\r\n      .collection('likes')\r\n      .doc(userId)\r\n      .get()\r\n    \r\n    return likeDoc.exists\r\n  } catch (error: any) {\r\n    console.error('[Server] Error checking like:', error)\r\n    return false\r\n  }\r\n}\r\n\r\n/**\r\n * Get user's liked posts\r\n */\r\nexport async function getUserLikedPosts(userId: string): Promise<Set<string>> {\r\n  try {\r\n    const db = getAdminDb()\r\n    \r\n    // Get all posts user has liked\r\n    // Note: This is expensive, so we'll optimize by getting likes from user's subcollection\r\n    // But for now, we'll use a different approach - check likes on each post\r\n    \r\n    // Actually, we should store likes in posts/{postId}/likes/{userId}\r\n    // So we need to query all posts and check their likes subcollections\r\n    // This is not efficient, but for MVP it's acceptable\r\n    \r\n    // Better approach: Store user's likes in a separate collection or use client-side caching\r\n    // For now, return empty set and let client handle it\r\n    return new Set()\r\n  } catch (error: any) {\r\n    console.error('[Server] Error getting user liked posts:', error)\r\n    return new Set()\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;;IAsJsB,eAAA,WAAA,GAAA,IAAA,wYAAA,EAAA,8CAAA,6XAAA,EAAA,KAAA,GAAA,mYAAA,EAAA"}},
    {"offset": {"line": 2123, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/hp/Downloads/anonymous-social-platform/app/actions/posts.ts"],"sourcesContent":["'use server'\r\n\r\nimport { getAuthInstance } from '@/lib/firebase'\r\nimport { getAdminDb, getAdminAuth, isAdmin } from '@/lib/firebase-admin'\r\nimport { getStorageInstance } from '@/lib/firebase'\r\nimport { ref, uploadBytes, getDownloadURL, deleteObject } from 'firebase/storage'\r\nimport { generateWaveformFromBlob } from '@/lib/waveform-generator'\r\nimport { Timestamp } from 'firebase-admin/firestore'\r\n\r\ninterface CreatePostParams {\r\n  type: 'text' | 'voice'\r\n  content?: string | null\r\n  mediaBlob?: Blob | null\r\n  mediaMimeType?: string | null\r\n}\r\n\r\ninterface EditPostParams {\r\n  postId: string\r\n  content?: string\r\n  text?: string\r\n  genre?: string\r\n  modulationType?: 'original' | 'deep' | 'robot' | 'whisper'\r\n  mediaBlob?: Blob // For re-processing voice with new modulation\r\n}\r\n\r\n/**\r\n * Rate limiting: Check if user posted within last 2 minutes\r\n */\r\nasync function checkRateLimit(userId: string): Promise<void> {\r\n  const db = getAdminDb()\r\n  const postsRef = db.collection('posts')\r\n  \r\n  const twoMinutesAgo = Timestamp.fromMillis(Date.now() - 2 * 60 * 1000)\r\n  const recentPosts = await postsRef\r\n    .where('userId', '==', userId)\r\n    .where('createdAt', '>', twoMinutesAgo)\r\n    .limit(1)\r\n    .get()\r\n\r\n  if (!recentPosts.empty) {\r\n    throw new Error('Rate limit: Please wait 2 minutes between posts')\r\n  }\r\n}\r\n\r\n/**\r\n * Get user data with denormalized fields\r\n * Creates a default user document if it doesn't exist\r\n */\r\nasync function getUserData(userId: string) {\r\n  const db = getAdminDb()\r\n  const userDoc = await db.collection('users').doc(userId).get()\r\n  \r\n  if (!userDoc.exists) {\r\n    // Create a default user document if it doesn't exist\r\n    // This can happen if user authenticated but document creation failed\r\n    const defaultUserData = {\r\n      uid: userId,\r\n      username: 'Anonymous',\r\n      role: 'user',\r\n      status: 'active',\r\n      avatarUrl: '',\r\n      bio: '',\r\n      createdAt: Timestamp.now(),\r\n      updatedAt: Timestamp.now(),\r\n    }\r\n    \r\n    await db.collection('users').doc(userId).set(defaultUserData)\r\n    \r\n    return {\r\n      username: 'Anonymous',\r\n      avatarUrl: '',\r\n    }\r\n  }\r\n\r\n  const userData = userDoc.data()!\r\n  // Handle both old format (avatar) and new format (avatarUrl)\r\n  const avatarUrl = userData.avatarUrl || userData.avatar || ''\r\n  \r\n  return {\r\n    username: userData.username || 'Anonymous',\r\n    avatarUrl: avatarUrl,\r\n  }\r\n}\r\n\r\n/**\r\n * Check if user is shadowbanned\r\n */\r\nasync function isShadowbanned(userId: string): Promise<boolean> {\r\n  const db = getAdminDb()\r\n  const userDoc = await db.collection('users').doc(userId).get()\r\n  \r\n  if (!userDoc.exists) {\r\n    return false\r\n  }\r\n\r\n  const userData = userDoc.data()!\r\n  return userData.status === 'shadowbanned'\r\n}\r\n\r\n/**\r\n * Create a new post (text or voice)\r\n */\r\nexport async function createPost(params: CreatePostParams) {\r\n  try {\r\n    // Get auth token from request\r\n    // Note: In Next.js Server Actions, we need to pass the auth token\r\n    // For now, we'll use a workaround with client-side auth\r\n    // In production, use cookies or headers to pass the token\r\n    \r\n    const db = getAdminDb()\r\n    \r\n    // Validate input\r\n    if (params.type === 'text' && !params.content?.trim()) {\r\n      throw new Error('Text content is required')\r\n    }\r\n    \r\n    if (params.type === 'voice') {\r\n      if (!params.mediaBlob) {\r\n        throw new Error('Voice recording is required')\r\n      }\r\n      \r\n      // Validate duration (60 seconds max)\r\n      // We'll check this on the client side, but validate file size here\r\n      if (params.mediaBlob.size > 5 * 1024 * 1024) {\r\n        throw new Error('Voice file must be less than 5MB')\r\n      }\r\n    }\r\n\r\n    // Note: In a real implementation, you'd get userId from the auth token\r\n    // For now, we'll need to pass it from the client\r\n    // This is a limitation - we'll need to refactor auth context\r\n    \r\n    throw new Error('createPost: Auth token required - needs refactoring')\r\n  } catch (error: any) {\r\n    console.error('[Server] Error creating post:', error)\r\n    throw error\r\n  }\r\n}\r\n\r\ninterface CreatePostWithAuthParams extends CreatePostParams {\r\n  mediaDuration?: number // Duration in seconds (required for voice posts)\r\n  genre?: string // Genre (required for all posts)\r\n  modulationType?: 'original' | 'deep' | 'robot' | 'whisper' // Voice modulation type\r\n}\r\n\r\n/**\r\n * Create post with userId (called from client with auth)\r\n * This is a temporary solution until we implement proper token passing\r\n */\r\nexport async function createPostWithAuth(\r\n  userId: string,\r\n  params: CreatePostWithAuthParams\r\n) {\r\n  try {\r\n    const db = getAdminDb()\r\n    \r\n    // Check rate limit\r\n    await checkRateLimit(userId)\r\n    \r\n    // Check if user is shadowbanned\r\n    const shadowbanned = await isShadowbanned(userId)\r\n    if (shadowbanned) {\r\n      // Shadowbanned users can post, but posts won't appear to others\r\n      // We'll handle this in the feed query\r\n    }\r\n    \r\n    // Get user data for denormalization\r\n    const userData = await getUserData(userId)\r\n    \r\n    // Validate input\r\n    if (!params.genre) {\r\n      throw new Error('Genre is required for all posts')\r\n    }\r\n    \r\n    if (params.type === 'text' && !params.content?.trim()) {\r\n      throw new Error('Text content is required')\r\n    }\r\n    \r\n    if (params.type === 'voice') {\r\n      if (!params.mediaBlob) {\r\n        throw new Error('Voice recording is required')\r\n      }\r\n      \r\n      if (params.mediaBlob.size > 5 * 1024 * 1024) {\r\n        throw new Error('Voice file must be less than 5MB')\r\n      }\r\n      \r\n      if (!params.mediaDuration || params.mediaDuration > 60) {\r\n        throw new Error('Voice recording must be 60 seconds or less')\r\n      }\r\n      \r\n      if (!params.modulationType) {\r\n        throw new Error('Modulation type is required for voice posts')\r\n      }\r\n    }\r\n\r\n    const now = Timestamp.now()\r\n    \r\n    // Get genre color\r\n    const genreColors: Record<string, string> = {\r\n      'Confession': '#FF6B6B',\r\n      'Motivation': '#6BCB77',\r\n      'Love / Heartbreak': '#A66CFF',\r\n      'Dark Thoughts': '#FF4C4C',\r\n      'Friendship': '#4D96FF',\r\n      'Life Advice': '#FFD93D',\r\n      'Humor': '#FF9F1C',\r\n      'Storytime': '#845EC2',\r\n    }\r\n    \r\n    const postData: any = {\r\n      id: '', // Will be set when creating document\r\n      userId,\r\n      genre: params.genre,\r\n      genreColor: genreColors[params.genre] || '#8b5cf6',\r\n      modulationType: params.type === 'voice' ? (params.modulationType || 'original') : null,\r\n      audioUrl: null,\r\n      text: params.type === 'text' ? params.content : null,\r\n      duration: params.type === 'voice' ? (params.mediaDuration || 0) : 0,\r\n      reported: false,\r\n      reports: [],\r\n      authorUsername: userData.username,\r\n      authorAvatarUrl: userData.avatarUrl,\r\n      type: params.type,\r\n      content: params.type === 'text' ? params.content : null, // Keep for backward compatibility\r\n      mediaUrl: null,\r\n      mediaDuration: params.type === 'voice' ? params.mediaDuration : null,\r\n      mediaMimeType: null,\r\n      waveform: null,\r\n      status: 'active',\r\n      likesCount: 0,\r\n      commentsCount: 0,\r\n      createdAt: now,\r\n      updatedAt: now,\r\n      isEdited: false,\r\n    }\r\n\r\n    // Handle voice post\r\n    if (params.type === 'voice' && params.mediaBlob) {\r\n      // Upload audio file\r\n      const storage = getStorageInstance()\r\n      if (!storage) {\r\n        throw new Error('Storage not initialized')\r\n      }\r\n\r\n      const postId = db.collection('posts').doc().id\r\n      const storagePath = `voice-posts/${userId}/${postId}.webm`\r\n      const storageRef = ref(storage, storagePath)\r\n      \r\n      await uploadBytes(storageRef, params.mediaBlob)\r\n      const mediaUrl = await getDownloadURL(storageRef)\r\n      \r\n      // Generate waveform\r\n      const waveform = await generateWaveformFromBlob(params.mediaBlob, 100)\r\n      \r\n      postData.mediaUrl = mediaUrl\r\n      postData.audioUrl = mediaUrl // Also set audioUrl for new data model\r\n      postData.mediaDuration = params.mediaDuration\r\n      postData.duration = params.mediaDuration // Also set duration for new data model\r\n      postData.mediaMimeType = params.mediaMimeType || 'audio/webm'\r\n      postData.waveform = waveform\r\n      postData.id = postId\r\n      \r\n      // Create post document\r\n      await db.collection('posts').doc(postId).set(postData)\r\n      return { success: true, postId }\r\n    } else {\r\n      // Text post\r\n      const postRef = db.collection('posts').doc()\r\n      postData.id = postRef.id\r\n      await postRef.set(postData)\r\n      return { success: true, postId: postRef.id }\r\n    }\r\n  } catch (error: any) {\r\n    console.error('[Server] Error creating post:', error)\r\n    throw error\r\n  }\r\n}\r\n\r\n/**\r\n * Edit post (text, genre, and voice modulation can be updated)\r\n */\r\nexport async function editPost(userId: string, params: EditPostParams) {\r\n  try {\r\n    const db = getAdminDb()\r\n    const postRef = db.collection('posts').doc(params.postId)\r\n    const postDoc = await postRef.get()\r\n    \r\n    if (!postDoc.exists) {\r\n      throw new Error('Post not found')\r\n    }\r\n    \r\n    const postData = postDoc.data()!\r\n    \r\n    // Verify ownership\r\n    if (postData.userId !== userId) {\r\n      throw new Error('Unauthorized: You can only edit your own posts')\r\n    }\r\n    \r\n    const updateData: any = {\r\n      updatedAt: Timestamp.now(),\r\n      isEdited: true,\r\n    }\r\n    \r\n    // Update text content (for text posts or voice captions)\r\n    if (params.text !== undefined || params.content !== undefined) {\r\n      const textContent = params.text || params.content\r\n      if (!textContent?.trim()) {\r\n        throw new Error('Content cannot be empty')\r\n      }\r\n      updateData.text = textContent\r\n      updateData.content = textContent // Keep for backward compatibility\r\n    }\r\n    \r\n    // Update genre\r\n    if (params.genre) {\r\n      const genreColors: Record<string, string> = {\r\n        'Confession': '#FF6B6B',\r\n        'Motivation': '#6BCB77',\r\n        'Love / Heartbreak': '#A66CFF',\r\n        'Dark Thoughts': '#FF4C4C',\r\n        'Friendship': '#4D96FF',\r\n        'Life Advice': '#FFD93D',\r\n        'Humor': '#FF9F1C',\r\n        'Storytime': '#845EC2',\r\n      }\r\n      updateData.genre = params.genre\r\n      updateData.genreColor = genreColors[params.genre] || '#8b5cf6'\r\n    }\r\n    \r\n    // Update modulation for voice posts (requires re-processing)\r\n    if (params.modulationType && postData.type === 'voice') {\r\n      if (params.mediaBlob) {\r\n        // Re-process audio with new modulation\r\n        const storage = getStorageInstance()\r\n        if (!storage) {\r\n          throw new Error('Storage not initialized')\r\n        }\r\n        \r\n        const storagePath = `voice-posts/${userId}/${params.postId}.webm`\r\n        const storageRef = ref(storage, storagePath)\r\n        \r\n        await uploadBytes(storageRef, params.mediaBlob)\r\n        const audioUrl = await getDownloadURL(storageRef)\r\n        \r\n        // Generate new waveform\r\n        const waveform = await generateWaveformFromBlob(params.mediaBlob, 100)\r\n        \r\n        updateData.audioUrl = audioUrl\r\n        updateData.mediaUrl = audioUrl // Keep for backward compatibility\r\n        updateData.waveform = waveform\r\n      }\r\n      updateData.modulationType = params.modulationType\r\n    }\r\n    \r\n    // Update post\r\n    await postRef.update(updateData)\r\n    \r\n    return { success: true }\r\n  } catch (error: any) {\r\n    console.error('[Server] Error editing post:', error)\r\n    throw error\r\n  }\r\n}\r\n\r\n/**\r\n * Edit text post (backward compatibility)\r\n */\r\nexport async function editTextPost(userId: string, params: EditPostParams) {\r\n  return editPost(userId, { ...params, text: params.content })\r\n}\r\n\r\n/**\r\n * Delete post\r\n */\r\nexport async function deletePost(userId: string, postId: string) {\r\n  try {\r\n    const db = getAdminDb()\r\n    const postRef = db.collection('posts').doc(postId)\r\n    const postDoc = await postRef.get()\r\n    \r\n    if (!postDoc.exists) {\r\n      throw new Error('Post not found')\r\n    }\r\n    \r\n    const postData = postDoc.data()!\r\n    \r\n    // Verify ownership or admin\r\n    const userIsAdmin = await isAdmin(userId)\r\n    if (postData.userId !== userId && !userIsAdmin) {\r\n      throw new Error('Unauthorized')\r\n    }\r\n    \r\n    // Delete audio file from storage if voice post\r\n    if (postData.type === 'voice' && postData.audioUrl) {\r\n      try {\r\n        const storage = getStorageInstance()\r\n        if (storage) {\r\n          // Extract path from URL or use standard path\r\n          const storagePath = `voice-posts/${postData.userId}/${params.postId}.webm`\r\n          const storageRef = ref(storage, storagePath)\r\n          // Note: Firebase Admin SDK needed for delete, but we can mark for deletion\r\n          // For now, we'll rely on Storage rules and manual cleanup\r\n        }\r\n      } catch (storageError) {\r\n        console.error('[Server] Error deleting audio file:', storageError)\r\n        // Continue with post deletion even if storage deletion fails\r\n      }\r\n    }\r\n    \r\n    // Delete post document\r\n    await postRef.delete()\r\n    \r\n    return { success: true }\r\n  } catch (error: any) {\r\n    console.error('[Server] Error deleting post:', error)\r\n    throw error\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;;IAuXsB,aAAA,WAAA,GAAA,IAAA,wYAAA,EAAA,8CAAA,6XAAA,EAAA,KAAA,GAAA,mYAAA,EAAA"}},
    {"offset": {"line": 2135, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/hp/Downloads/anonymous-social-platform/app/actions/auth.ts"],"sourcesContent":["'use server'\r\n\r\nimport { getAdminDb } from '@/lib/firebase-admin'\r\nimport { Timestamp } from 'firebase-admin/firestore'\r\n\r\ninterface CreateUsernameParams {\r\n  userId: string\r\n  username: string\r\n}\r\n\r\ninterface UpdateUserProfileParams {\r\n  userId: string\r\n  avatar?: string\r\n  bio?: string\r\n}\r\n\r\n/**\r\n * Create or update username for a user\r\n * Enforces uniqueness using usernames collection\r\n */\r\nexport async function createUsername(params: CreateUsernameParams) {\r\n  try {\r\n    const db = getAdminDb()\r\n    \r\n    // Validate username\r\n    const usernameLower = params.username.toLowerCase().trim()\r\n    \r\n    if (!usernameLower || usernameLower.length < 3) {\r\n      throw new Error('Username must be at least 3 characters')\r\n    }\r\n    \r\n    if (usernameLower.length > 20) {\r\n      throw new Error('Username must be less than 20 characters')\r\n    }\r\n    \r\n    if (!/^[a-z0-9_]+$/.test(usernameLower)) {\r\n      throw new Error('Username can only contain letters, numbers, and underscores')\r\n    }\r\n    \r\n    // Check if username is already taken\r\n    const usernameDoc = await db.collection('usernames').doc(usernameLower).get()\r\n    \r\n    if (usernameDoc.exists) {\r\n      const existingUid = usernameDoc.data()!.uid\r\n      if (existingUid !== params.userId) {\r\n        throw new Error('Username is already taken')\r\n      }\r\n      // Same user, allow update\r\n    }\r\n    \r\n    // Get existing user data\r\n    const userDoc = await db.collection('users').doc(params.userId).get()\r\n    const existingUsername = userDoc.exists ? userDoc.data()?.usernameLower : null\r\n    \r\n    // Update usernames collection\r\n    await db.collection('usernames').doc(usernameLower).set({\r\n      uid: params.userId,\r\n    })\r\n    \r\n    // If user had a different username, remove old entry\r\n    if (existingUsername && existingUsername !== usernameLower) {\r\n      await db.collection('usernames').doc(existingUsername).delete()\r\n    }\r\n    \r\n    // Update user document\r\n    const userData: any = {\r\n      username: params.username,\r\n      usernameLower,\r\n      updatedAt: Timestamp.now(),\r\n    }\r\n    \r\n    if (!userDoc.exists) {\r\n      // Create new user document\r\n      userData.uid = params.userId\r\n      userData.role = 'user'\r\n      userData.status = 'active'\r\n      userData.avatarUrl = ''\r\n      userData.bio = ''\r\n      userData.createdAt = Timestamp.now()\r\n    }\r\n    \r\n    await db.collection('users').doc(params.userId).set(userData, { merge: true })\r\n    \r\n    return { success: true, username: params.username }\r\n  } catch (error: any) {\r\n    console.error('[Server] Error creating username:', error)\r\n    throw error\r\n  }\r\n}\r\n\r\nexport async function updateUserProfile(params: UpdateUserProfileParams) {\r\n  try {\r\n    const db = getAdminDb()\r\n\r\n    const updates: any = {\r\n      updatedAt: Timestamp.now(),\r\n    }\r\n\r\n    if (typeof params.avatar !== 'undefined') {\r\n      updates.avatar = params.avatar\r\n    }\r\n\r\n    if (typeof params.bio !== 'undefined') {\r\n      updates.bio = params.bio\r\n    }\r\n\r\n    await db.collection('users').doc(params.userId).set(updates, { merge: true })\r\n\r\n    const userDoc = await db.collection('users').doc(params.userId).get()\r\n\r\n    return {\r\n      success: true,\r\n      user: {\r\n        uid: params.userId,\r\n        ...userDoc.data(),\r\n      },\r\n    }\r\n  } catch (error: any) {\r\n    console.error('[Server] Error updating user profile:', error)\r\n    throw error\r\n  }\r\n}\r\n\r\n/**\r\n * Get user by username\r\n */\r\nexport async function getUserByUsername(username: string) {\r\n  try {\r\n    const db = getAdminDb()\r\n    const usernameLower = username.toLowerCase()\r\n    \r\n    const usernameDoc = await db.collection('usernames').doc(usernameLower).get()\r\n    \r\n    if (!usernameDoc.exists) {\r\n      return null\r\n    }\r\n    \r\n    const uid = usernameDoc.data()!.uid\r\n    const userDoc = await db.collection('users').doc(uid).get()\r\n    \r\n    if (!userDoc.exists) {\r\n      return null\r\n    }\r\n    \r\n    return {\r\n      uid,\r\n      ...userDoc.data(),\r\n    }\r\n  } catch (error: any) {\r\n    console.error('[Server] Error getting user by username:', error)\r\n    return null\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;;IAoBsB,iBAAA,WAAA,GAAA,IAAA,wYAAA,EAAA,8CAAA,6XAAA,EAAA,KAAA,GAAA,mYAAA,EAAA"}},
    {"offset": {"line": 2147, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/hp/Downloads/anonymous-social-platform/app/actions/auth.ts"],"sourcesContent":["'use server'\r\n\r\nimport { getAdminDb } from '@/lib/firebase-admin'\r\nimport { Timestamp } from 'firebase-admin/firestore'\r\n\r\ninterface CreateUsernameParams {\r\n  userId: string\r\n  username: string\r\n}\r\n\r\ninterface UpdateUserProfileParams {\r\n  userId: string\r\n  avatar?: string\r\n  bio?: string\r\n}\r\n\r\n/**\r\n * Create or update username for a user\r\n * Enforces uniqueness using usernames collection\r\n */\r\nexport async function createUsername(params: CreateUsernameParams) {\r\n  try {\r\n    const db = getAdminDb()\r\n    \r\n    // Validate username\r\n    const usernameLower = params.username.toLowerCase().trim()\r\n    \r\n    if (!usernameLower || usernameLower.length < 3) {\r\n      throw new Error('Username must be at least 3 characters')\r\n    }\r\n    \r\n    if (usernameLower.length > 20) {\r\n      throw new Error('Username must be less than 20 characters')\r\n    }\r\n    \r\n    if (!/^[a-z0-9_]+$/.test(usernameLower)) {\r\n      throw new Error('Username can only contain letters, numbers, and underscores')\r\n    }\r\n    \r\n    // Check if username is already taken\r\n    const usernameDoc = await db.collection('usernames').doc(usernameLower).get()\r\n    \r\n    if (usernameDoc.exists) {\r\n      const existingUid = usernameDoc.data()!.uid\r\n      if (existingUid !== params.userId) {\r\n        throw new Error('Username is already taken')\r\n      }\r\n      // Same user, allow update\r\n    }\r\n    \r\n    // Get existing user data\r\n    const userDoc = await db.collection('users').doc(params.userId).get()\r\n    const existingUsername = userDoc.exists ? userDoc.data()?.usernameLower : null\r\n    \r\n    // Update usernames collection\r\n    await db.collection('usernames').doc(usernameLower).set({\r\n      uid: params.userId,\r\n    })\r\n    \r\n    // If user had a different username, remove old entry\r\n    if (existingUsername && existingUsername !== usernameLower) {\r\n      await db.collection('usernames').doc(existingUsername).delete()\r\n    }\r\n    \r\n    // Update user document\r\n    const userData: any = {\r\n      username: params.username,\r\n      usernameLower,\r\n      updatedAt: Timestamp.now(),\r\n    }\r\n    \r\n    if (!userDoc.exists) {\r\n      // Create new user document\r\n      userData.uid = params.userId\r\n      userData.role = 'user'\r\n      userData.status = 'active'\r\n      userData.avatarUrl = ''\r\n      userData.bio = ''\r\n      userData.createdAt = Timestamp.now()\r\n    }\r\n    \r\n    await db.collection('users').doc(params.userId).set(userData, { merge: true })\r\n    \r\n    return { success: true, username: params.username }\r\n  } catch (error: any) {\r\n    console.error('[Server] Error creating username:', error)\r\n    throw error\r\n  }\r\n}\r\n\r\nexport async function updateUserProfile(params: UpdateUserProfileParams) {\r\n  try {\r\n    const db = getAdminDb()\r\n\r\n    const updates: any = {\r\n      updatedAt: Timestamp.now(),\r\n    }\r\n\r\n    if (typeof params.avatar !== 'undefined') {\r\n      updates.avatar = params.avatar\r\n    }\r\n\r\n    if (typeof params.bio !== 'undefined') {\r\n      updates.bio = params.bio\r\n    }\r\n\r\n    await db.collection('users').doc(params.userId).set(updates, { merge: true })\r\n\r\n    const userDoc = await db.collection('users').doc(params.userId).get()\r\n\r\n    return {\r\n      success: true,\r\n      user: {\r\n        uid: params.userId,\r\n        ...userDoc.data(),\r\n      },\r\n    }\r\n  } catch (error: any) {\r\n    console.error('[Server] Error updating user profile:', error)\r\n    throw error\r\n  }\r\n}\r\n\r\n/**\r\n * Get user by username\r\n */\r\nexport async function getUserByUsername(username: string) {\r\n  try {\r\n    const db = getAdminDb()\r\n    const usernameLower = username.toLowerCase()\r\n    \r\n    const usernameDoc = await db.collection('usernames').doc(usernameLower).get()\r\n    \r\n    if (!usernameDoc.exists) {\r\n      return null\r\n    }\r\n    \r\n    const uid = usernameDoc.data()!.uid\r\n    const userDoc = await db.collection('users').doc(uid).get()\r\n    \r\n    if (!userDoc.exists) {\r\n      return null\r\n    }\r\n    \r\n    return {\r\n      uid,\r\n      ...userDoc.data(),\r\n    }\r\n  } catch (error: any) {\r\n    console.error('[Server] Error getting user by username:', error)\r\n    return null\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;;IA0FsB,oBAAA,WAAA,GAAA,IAAA,wYAAA,EAAA,8CAAA,6XAAA,EAAA,KAAA,GAAA,mYAAA,EAAA"}},
    {"offset": {"line": 2159, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/hp/Downloads/anonymous-social-platform/lib/username-generator.ts"],"sourcesContent":["/**\r\n * Generate unique anonymous usernames\r\n * Pattern: @silentwave57, @ghostuser42, etc.\r\n */\r\n\r\nconst adjectives = [\r\n  'silent', 'ghost', 'shadow', 'mystic', 'hidden', 'quiet', 'whisper',\r\n  'dark', 'lonely', 'empty', 'void', 'secret', 'anonymous', 'unknown',\r\n  'lost', 'broken', 'faded', 'distant', 'cold', 'warm', 'soft', 'gentle',\r\n  'wild', 'free', 'brave', 'bold', 'calm', 'peaceful', 'serene'\r\n]\r\n\r\nconst nouns = [\r\n  'wave', 'ocean', 'soul', 'spirit', 'heart', 'mind', 'dream', 'night',\r\n  'day', 'star', 'moon', 'sun', 'wind', 'storm', 'rain', 'cloud',\r\n  'river', 'lake', 'forest', 'mountain', 'valley', 'desert', 'island',\r\n  'bird', 'wolf', 'fox', 'deer', 'cat', 'dog', 'lion', 'tiger',\r\n  'user', 'ghost', 'shadow', 'phantom', 'wanderer', 'traveler', 'explorer'\r\n]\r\n\r\n/**\r\n * Generate a random username\r\n * Format: {adjective}{noun}{randomNumber}\r\n * Example: silentwave57, ghostuser42\r\n */\r\nexport function generateUsername(): string {\r\n  const adjective = adjectives[Math.floor(Math.random() * adjectives.length)]\r\n  const noun = nouns[Math.floor(Math.random() * nouns.length)]\r\n  const number = Math.floor(Math.random() * 100) // 0-99\r\n  \r\n  return `${adjective}${noun}${number}`\r\n}\r\n\r\n/**\r\n * Generate a username with @ prefix for display\r\n */\r\nexport function generateDisplayUsername(): string {\r\n  return `@${generateUsername()}`\r\n}\r\n\r\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;;;AAED,MAAM,aAAa;IACjB;IAAU;IAAS;IAAU;IAAU;IAAU;IAAS;IAC1D;IAAQ;IAAU;IAAS;IAAQ;IAAU;IAAa;IAC1D;IAAQ;IAAU;IAAS;IAAW;IAAQ;IAAQ;IAAQ;IAC9D;IAAQ;IAAQ;IAAS;IAAQ;IAAQ;IAAY;CACtD;AAED,MAAM,QAAQ;IACZ;IAAQ;IAAS;IAAQ;IAAU;IAAS;IAAQ;IAAS;IAC7D;IAAO;IAAQ;IAAQ;IAAO;IAAQ;IAAS;IAAQ;IACvD;IAAS;IAAQ;IAAU;IAAY;IAAU;IAAU;IAC3D;IAAQ;IAAQ;IAAO;IAAQ;IAAO;IAAO;IAAQ;IACrD;IAAQ;IAAS;IAAU;IAAW;IAAY;IAAY;CAC/D;AAOM,SAAS;IACd,MAAM,YAAY,UAAU,CAAC,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,WAAW,MAAM,EAAE;IAC3E,MAAM,OAAO,KAAK,CAAC,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,MAAM,MAAM,EAAE;IAC5D,MAAM,SAAS,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,KAAK,OAAO;;IAEtD,OAAO,GAAG,YAAY,OAAO,QAAQ;AACvC;AAKO,SAAS;IACd,OAAO,CAAC,CAAC,EAAE,oBAAoB;AACjC"}},
    {"offset": {"line": 2253, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/hp/Downloads/anonymous-social-platform/components/app/edit-profile-modal.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useState } from 'react'\r\nimport { createUsername, updateUserProfile } from '@/app/actions/auth'\r\nimport { generateUsername } from '@/lib/username-generator'\r\nimport { toast } from 'sonner'\r\n\r\ninterface EditProfileModalProps {\r\n  userId: string\r\n  initialProfile: {\r\n    username?: string\r\n    bio?: string\r\n    avatar?: string\r\n  }\r\n  onClose: () => void\r\n  onUpdated: (user: any) => void\r\n}\r\n\r\nexport function EditProfileModal({ userId, initialProfile, onClose, onUpdated }: EditProfileModalProps) {\r\n  const [username, setUsername] = useState(initialProfile.username || '')\r\n  const [avatar, setAvatar] = useState(initialProfile.avatar || 'üëª')\r\n  const [bio, setBio] = useState(initialProfile.bio || '')\r\n  const [loading, setLoading] = useState(false)\r\n  const [error, setError] = useState('')\r\n\r\n  const avatarOptions = ['üëª', 'üåô', '‚≠ê', 'ü¶ä', 'üê±', 'üê∫', 'üí´', 'üñ§']\r\n\r\n  const handleRandomUsername = () => {\r\n    const generated = generateUsername()\r\n    setUsername(generated)\r\n  }\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault()\r\n\r\n    const trimmedUsername = username.trim()\r\n\r\n    if (!trimmedUsername) {\r\n      setError('Username is required')\r\n      return\r\n    }\r\n\r\n    if (trimmedUsername.length < 3 || trimmedUsername.length > 20) {\r\n      setError('Username must be between 3 and 20 characters')\r\n      return\r\n    }\r\n\r\n    if (!/^[a-z0-9_]+$/.test(trimmedUsername)) {\r\n      setError('Username can only contain letters, numbers, and underscores')\r\n      return\r\n    }\r\n\r\n    try {\r\n      setLoading(true)\r\n      setError('')\r\n\r\n      const usernameChanged = trimmedUsername !== (initialProfile.username || '')\r\n\r\n      if (usernameChanged) {\r\n        await createUsername({\r\n          userId,\r\n          username: trimmedUsername,\r\n        })\r\n      }\r\n\r\n      const result = await updateUserProfile({\r\n        userId,\r\n        avatar,\r\n        bio: bio.trim(),\r\n      })\r\n\r\n      if (result?.success) {\r\n        toast.success('Profile updated')\r\n        onUpdated(result.user)\r\n        onClose()\r\n      }\r\n    } catch (err: any) {\r\n      console.error('[Profile] Error updating profile:', err)\r\n      setError(err.message || 'Failed to update profile')\r\n      toast.error(err.message || 'Failed to update profile')\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\r\n      <div className=\"bg-dark-card/95 border border-dark-border rounded-2xl w-full max-w-md shadow-2xl shadow-black/40\">\r\n        <div className=\"flex items-center justify-between p-6 border-b border-dark-border\">\r\n          <h2 className=\"text-2xl font-bold\">Edit Profile</h2>\r\n          <button\r\n            onClick={onClose}\r\n            className=\"text-gray-400 hover:text-white text-2xl transition\"\r\n          >\r\n            \r\n            \r\n            ‚úï\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"p-6 space-y-6\">\r\n          {error && (\r\n            <div className=\"p-3 bg-error/20 border border-error text-error rounded-lg text-sm\">\r\n              {error}\r\n            </div>\r\n          )}\r\n\r\n          <form onSubmit={handleSubmit} className=\"space-y-6\">\r\n            <div className=\"space-y-3 max-w-sm mx-auto\">\r\n              <label className=\"block text-sm font-medium\">Avatar</label>\r\n              <div className=\"grid grid-cols-4 gap-2 justify-items-center sm:grid-cols-8\">\r\n                {avatarOptions.map((option) => (\r\n                  <button\r\n                    key={option}\r\n                    type=\"button\"\r\n                    onClick={() => setAvatar(option)}\r\n                    className={`w-10 h-10 rounded-full flex items-center justify-center text-2xl border transition ${\r\n                      avatar === option\r\n                        ? 'bg-primary/20 border-primary shadow-lg shadow-black/40'\r\n                        : 'bg-dark-secondary border-dark-border hover:border-primary'\r\n                    }`}\r\n                  >\r\n                    {option}\r\n                  </button>\r\n                ))}\r\n              </div>\r\n              <div className=\"flex justify-end pt-1\">\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => setAvatar('üëª')}\r\n                  className=\"px-3 py-1.5 text-xs bg-dark-secondary border border-dark-border rounded-full hover:border-primary transition\"\r\n                >\r\n                  Reset\r\n                </button>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"space-y-2 max-w-sm mx-auto\">\r\n              <label className=\"block text-sm font-medium\">Username</label>\r\n              <div className=\"flex items-center gap-2\">\r\n                <div className=\"flex-1 flex items-center gap-2 bg-dark-secondary border border-dark-border rounded-full px-4 py-2 focus-within:border-primary transition\">\r\n                  <span className=\"text-gray-400\">@</span>\r\n                  <input\r\n                    type=\"text\"\r\n                    value={username}\r\n                    onChange={(e) => {\r\n                      setUsername(e.target.value.toLowerCase().replace(/[^a-z0-9_]/g, ''))\r\n                      setError('')\r\n                    }}\r\n                    placeholder=\"username\"\r\n                    disabled={loading}\r\n                    maxLength={20}\r\n                    minLength={3}\r\n                    pattern=\"[a-z0-9_]+\"\r\n                    className=\"flex-1 bg-transparent border-none outline-none text-white placeholder-gray-500 disabled:opacity-50\"\r\n                  />\r\n                </div>\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={handleRandomUsername}\r\n                  disabled={loading}\r\n                  className=\"w-11 h-11 rounded-full bg-dark-secondary border border-dark-border flex items-center justify-center hover:border-primary transition disabled:opacity-50\"\r\n                  title=\"Generate random username\"\r\n                >\r\n                  üé≤\r\n                </button>\r\n              </div>\r\n              <p className=\"text-xs text-gray-400\">\r\n                {username.length}/20 characters ‚Ä¢ Letters, numbers, and underscores only\r\n              </p>\r\n            </div>\r\n\r\n            <div className=\"space-y-2 max-w-sm mx-auto\">\r\n              <label className=\"block text-sm font-medium\">Bio</label>\r\n              <textarea\r\n                value={bio}\r\n                onChange={(e) => setBio(e.target.value)}\r\n                placeholder=\"Anonymous soul sharing stories\"\r\n                maxLength={200}\r\n                rows={3}\r\n                className=\"w-full bg-dark-secondary border border-dark-border rounded-xl px-4 py-3 text-sm text-white placeholder-gray-500 focus:outline-none focus:border-primary transition resize-none\"\r\n              />\r\n              <p className=\"text-xs text-gray-400\">{bio.length}/200 characters</p>\r\n            </div>\r\n\r\n            <div className=\"max-w-sm mx-auto\">\r\n              <button\r\n                type=\"submit\"\r\n                disabled={loading}\r\n                className=\"w-full btn-primary py-3 font-bold disabled:opacity-50 disabled:cursor-not-allowed shadow-lg shadow-black/40\"\r\n              >\r\n                {loading ? 'Saving...' : 'Save Changes'}\r\n              </button>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2598, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/hp/Downloads/anonymous-social-platform/app/profile/%5Buid%5D/page.tsx"],"sourcesContent":["'use client'\n\nimport { useEffect, useState, use } from 'react'\nimport { useRouter } from 'next/navigation'\nimport Link from 'next/link'\nimport { motion } from 'framer-motion'\nimport { Header } from '@/components/app/header'\nimport { PostCard } from '@/components/app/post-card'\nimport { PostCardSkeleton } from '@/components/app/post-card-skeleton'\nimport { getUser } from '@/lib/firestore-utils'\nimport { getUserPosts } from '@/app/actions/feed'\nimport { useAuth } from '@/lib/auth-context'\nimport { deletePost, editPost } from '@/app/actions/posts'\nimport { toast } from 'sonner'\nimport { EditProfileModal } from '@/components/app/edit-profile-modal'\n\nexport default function ProfilePage({ params }: { params: Promise<{ uid: string }> }) {\n  const { uid } = use(params)\n  const router = useRouter()\n  const { user } = useAuth()\n  const [profileUser, setProfileUser] = useState<any>(null)\n  const [userPosts, setUserPosts] = useState<any[]>([])\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState<string | null>(null)\n  const [likedPosts, setLikedPosts] = useState<Set<string>>(new Set())\n  const [showEditMenu, setShowEditMenu] = useState<string | null>(null)\n  const [showEditProfile, setShowEditProfile] = useState(false)\n\n  useEffect(() => {\n    if (!uid) {\n      setError('User ID is required')\n      setLoading(false)\n      return\n    }\n\n    const loadProfile = async () => {\n      try {\n        setLoading(true)\n        const userData = await getUser(uid)\n        \n        if (!userData) {\n          throw new Error('User not found')\n        }\n        \n        setProfileUser(userData)\n        \n        try {\n          const posts = await getUserPosts(uid)\n          setUserPosts(posts)\n        } catch (postError) {\n          console.error('[v0] Error loading user posts:', postError)\n          setUserPosts([])\n        }\n        \n        setError(null)\n      } catch (error) {\n        console.error('[v0] Error loading profile:', error)\n        setProfileUser(null)\n        setUserPosts([])\n        setError('Failed to load profile')\n      } finally {\n        setLoading(false)\n      }\n    }\n\n    loadProfile()\n  }, [uid])\n\n  // Add smooth scrolling behavior to html element\n  useEffect(() => {\n    document.documentElement.setAttribute('data-scroll-behavior', 'smooth')\n    return () => {\n      document.documentElement.removeAttribute('data-scroll-behavior')\n    }\n  }, [])\n\n  const handleLike = (postId: string) => {\n    const newLiked = new Set(likedPosts)\n    if (newLiked.has(postId)) {\n      newLiked.delete(postId)\n    } else {\n      newLiked.add(postId)\n    }\n    setLikedPosts(newLiked)\n  }\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-dark-bg\">\n        <Header />\n        <div className=\"pt-24 pb-8 px-4\">\n          <div className=\"max-w-2xl mx-auto space-y-4\">\n            <div className=\"h-40 bg-dark-card rounded-xl animate-pulse\"></div>\n            <div className=\"h-96 bg-dark-card rounded-xl animate-pulse\"></div>\n          </div>\n        </div>\n      </div>\n    )\n  }\n\n  if (!profileUser) {\n    return (\n      <div className=\"min-h-screen bg-dark-bg\">\n        <Header />\n        <div className=\"pt-24 pb-8 px-4 text-center\">\n          <div className=\"text-5xl mb-4\">üëª</div>\n          <p className=\"text-gray-400 mb-6\">User not found</p>\n          <Link href=\"/app\" className=\"inline-block btn-primary\">\n            Back to Feed\n          </Link>\n        </div>\n      </div>\n    )\n  }\n\n  const isOwnProfile = user?.uid === uid\n\n  return (\n    <div className=\"min-h-screen bg-dark-bg\">\n      <Header />\n\n      <div className=\"pt-24 pb-8 px-4\">\n        <div className=\"max-w-2xl mx-auto\">\n          <div className=\"mb-4\">\n            <h1 className=\"text-2xl font-bold\">Profile</h1>\n          </div>\n\n          {/* Profile Header */}\n          <motion.div\n            initial={{ opacity: 0, y: 20 }}\n            animate={{ opacity: 1, y: 0 }}\n            className=\"card mb-8 relative overflow-hidden shadow-2xl shadow-black/40 border border-dark-border\"\n          >\n            {/* Gradient Cover */}\n            <div className=\"h-32 bg-gradient-to-r from-primary to-accent mb-16\"></div>\n\n            {isOwnProfile && (\n              <div className=\"absolute top-6 right-6 flex items-center gap-3\">\n                <button\n                  onClick={() => setShowEditProfile(true)}\n                  className=\"px-4 py-2 rounded-full bg-dark-bg/80 border border-dark-border hover:border-primary text-sm font-medium transition\"\n                >\n                  Edit Profile\n                </button>\n                <button\n                  className=\"w-9 h-9 rounded-full bg-dark-bg/80 border border-dark-border flex items-center justify-center text-lg hover:border-primary transition\"\n                >\n                  ¬∑¬∑¬∑\n                </button>\n              </div>\n            )}\n\n            <div className=\"px-6 pb-6 -mt-12 flex flex-col items-center text-center gap-3\">\n              {/* Avatar */}\n              <div className=\"w-24 h-24 rounded-full bg-gradient-to-br from-primary to-accent flex items-center justify-center text-5xl border-4 border-dark-card shadow-lg shadow-black/40\">\n                {profileUser.avatar || 'üëª'}\n              </div>\n\n              {/* Name and Handle */}\n              <div>\n                <h2 className=\"text-2xl font-bold mb-1\">\n                  {profileUser.username || profileUser.displayName || 'Anonymous'}\n                </h2>\n                <p className=\"text-gray-400 text-sm\">\n                  @{profileUser.username?.toLowerCase() || 'anonymous'}\n                </p>\n              </div>\n\n              {/* Bio */}\n              <p className=\"text-gray-300 text-sm max-w-md\">\n                {profileUser.bio || 'Anonymous soul sharing stories'}\n              </p>\n            </div>\n          </motion.div>\n\n          {isOwnProfile && showEditProfile && (\n            <EditProfileModal\n              userId={user!.uid}\n              initialProfile={{\n                username: profileUser.username,\n                bio: profileUser.bio,\n                avatar: profileUser.avatar,\n              }}\n              onClose={() => setShowEditProfile(false)}\n              onUpdated={(updated) => setProfileUser(updated)}\n            />\n          )}\n\n          {/* User Posts */}\n          <div>\n            <h2 className=\"text-xl font-bold mb-6\">Posts</h2>\n            {loading ? (\n              <div className=\"space-y-6\">\n                {[1, 2, 3].map((i) => (\n                  <PostCardSkeleton key={i} />\n                ))}\n              </div>\n            ) : userPosts.length === 0 ? (\n              <div className=\"text-center py-12\">\n                <div className=\"text-5xl mb-4 opacity-50\">üìù</div>\n                <p className=\"text-gray-400\">No posts yet</p>\n              </div>\n            ) : (\n              <div className=\"space-y-6\">\n                {userPosts.map((post) => (\n                  <div key={post.id} className=\"relative\">\n                    {isOwnProfile && (\n                      <div className=\"absolute top-4 right-4 z-10\">\n                        <button\n                          onClick={() => setShowEditMenu(showEditMenu === post.id ? null : post.id)}\n                          className=\"p-2 bg-dark-card/80 backdrop-blur-sm border border-dark-border rounded-lg hover:bg-dark-card transition\"\n                        >\n                          ‚Ä¢‚Ä¢‚Ä¢\n                        </button>\n                        {showEditMenu === post.id && (\n                          <div className=\"absolute right-0 top-full mt-2 bg-dark-card border border-dark-border rounded-lg shadow-lg z-20 min-w-[120px]\">\n                            <button\n                              onClick={async () => {\n                                setShowEditMenu(null)\n                                // TODO: Open edit modal\n                                toast.info('Edit functionality coming soon')\n                              }}\n                              className=\"w-full px-4 py-2 text-left text-sm hover:bg-dark-secondary transition\"\n                            >\n                              Edit\n                            </button>\n                            <button\n                              onClick={async () => {\n                                if (!confirm('Are you sure you want to delete this post?')) {\n                                  setShowEditMenu(null)\n                                  return\n                                }\n                                try {\n                                  await deletePost(user!.uid, post.id)\n                                  toast.success('Deleted')\n                                  // Reload posts\n                                  const posts = await getUserPosts(uid)\n                                  setUserPosts(posts)\n                                } catch (error: any) {\n                                  toast.error(error.message || 'Failed to delete')\n                                }\n                                setShowEditMenu(null)\n                              }}\n                              className=\"w-full px-4 py-2 text-left text-sm hover:bg-dark-secondary text-error transition\"\n                            >\n                              Delete\n                            </button>\n                          </div>\n                        )}\n                      </div>\n                    )}\n                    <PostCard\n                      post={post}\n                      isLiked={likedPosts.has(post.id)}\n                      onLike={() => handleLike(post.id)}\n                    />\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n\n          {/* Back Button */}\n          <div className=\"mt-8 text-center\">\n            <Link href=\"/app\" className=\"text-primary hover:text-accent transition\">\n              ‚Üê Back to Feed\n            </Link>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}}]
}